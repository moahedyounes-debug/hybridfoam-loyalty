<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>حجوزاتي</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <style>
        body {
            font-family: "Tajawal", sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 480px;
            margin: auto;
        }

        .card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 0 10px #0001;
        }

        h2 {
            text-align: center;
            margin-bottom: 25px;
        }

        .booking-box {
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .btn {
            display: block;
            width: 100%;
            padding: 14px;
            background: #007bff;
            color: white;
            text-align: center;
            border-radius: 8px;
            margin-top: 15px;
            text-decoration: none;
            font-size: 18px;
        }
    </style>
</head>

<body>

<div class="container">

    <h2>حجوزاتي</h2>

    <div id="bookingsList"></div>

    <a id="backBtn" class="btn">العودة للوحة التحكم</a>

</div>

<script src="api.js"></script>

<script>
/* ============================
   قراءة رقم الجوال من الرابط
   ============================ */
const urlParams = new URLSearchParams(window.location.search);
const phone = urlParams.get("phone");

if (!phone) {
    alert("رقم الجوال غير موجود");
}

/* ============================
   تحميل حجوزات العميل
   ============================ */
async function loadBookings() {
    const res = await apiGet({
        action: "getBookingsByPhone",
        phone
    });

    const list = document.getElementById("bookingsList");
    list.innerHTML = "";

    if (!res.success || res.bookings.length === 0) {
        list.innerHTML = "<p>لا توجد حجوزات حالياً</p>";
        return;
    }

    res.bookings.forEach(b => {
        const div = document.createElement("div");
        div.className = "booking-box";
        div.innerHTML = `
            <strong>${b.service}</strong><br>
            التاريخ: ${b.date}<br>
            الوقت: ${b.time}<br>
            الحالة: ${b.status}<br>
            المستوى: ${b.level}
        `;
        list.appendChild(div);
    });
}

/* ============================
   زر العودة للداشبورد
   ============================ */
document.getElementById("backBtn").href = "customer-dashboard.html?phone=" + phone;

/* ============================
   تحميل البيانات عند فتح الصفحة
   ============================ */
window.onload = function () {
    loadBookings();
};
</script>

</body>
</html>
