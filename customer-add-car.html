<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>إضافة سيارة</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="api.js"></script>

<style>
body { font-family:sans-serif; background:#f5f5f5; text-align:center; margin:0; padding:0; }
.header { background:#007bff; color:white; padding:20px; font-size:22px; }
select, input {
    width:85%; max-width:350px; padding:12px; margin:10px 0;
    border-radius:10px; border:1px solid #ccc; font-size:16px;
}
button {
    width:85%; max-width:350px; padding:14px; margin-top:15px;
    background:#28a745; color:white; border:none; border-radius:10px;
    font-size:18px; cursor:pointer;
}
button:disabled { opacity:0.6; }
.back {
    display:block; width:85%; max-width:350px; padding:14px;
    margin:20px auto; background:#6c757d; color:white;
    text-decoration:none; border-radius:10px;
}
.label { text-align:right; width:85%; max-width:350px; margin:0 auto; font-size:15px; color:#444; }
</style>
</head>

<body>

<div class="header">إضافة سيارة</div>

<div class="label">رقم العضوية</div>
<input id="membership" readonly>

<div class="label">نوع السيارة</div>
<select id="car">
    <option value="">اختر نوع السيارة</option>

    <!-- سيارات سيدان -->
    <option value="تويوتا كامري">تويوتا كامري</option>
    <option value="تويوتا كورولا">تويوتا كورولا</option>
    <option value="هيونداي سوناتا">هيونداي سوناتا</option>
    <option value="هيونداي النترا">هيونداي النترا</option>
    <option value="نيسان التيما">نيسان التيما</option>
    <option value="كيا K5">كيا K5</option>

    <!-- سيارات SUV -->
    <option value="تويوتا لاندكروزر">تويوتا لاندكروزر</option>
    <option value="تويوتا برادو">تويوتا برادو</option>
    <option value="نيسان باترول">نيسان باترول</option>
    <option value="فورد اكسبديشن">فورد اكسبديشن</option>
    <option value="جي ام سي يوكن">جي ام سي يوكن</option>
    <option value="شيفروليه تاهو">شيفروليه تاهو</option>

    <!-- بيك أب -->
    <option value="تويوتا هايلكس">تويوتا هايلكس</option>
    <option value="نيسان نافارا">نيسان نافارا</option>
    <option value="ديماكس">ديماكس</option>
</select>

<div class="label">أرقام اللوحة</div>
<input id="plateNumbers" placeholder="مثال: 1234">

<div class="label">حروف اللوحة</div>
<input id="plateLetters" placeholder="مثال: أ ب ج">

<button id="saveBtn" onclick="saveCar()">إضافة السيارة</button>

<a href="customer-dashboard.html" class="back">رجوع</a>

<script>
function normalizePhone(phone) {
    phone = String(phone).trim();
    if (!phone.startsWith("0")) phone = "0" + phone;
    return phone;
}

/* تحميل رقم العضوية من الـ API */
async function loadMembership() {
    const phone = normalizePhone(localStorage.getItem("customer_phone"));

    const res = await apiGet({
        action: "getMembership",
        phone
    });

    if (res.success) {
        document.getElementById("membership").value = res.membership;
    } else {
        document.getElementById("membership").value = "—";
    }
}

/* حفظ السيارة */
async function saveCar() {
    const btn = document.getElementById("saveBtn");
    btn.disabled = true;
    btn.innerText = "جاري الإضافة...";

    const phone = normalizePhone(localStorage.getItem("customer_phone"));
    const car = document.getElementById("car").value;
    const plate_numbers = document.getElementById("plateNumbers").value;
    const plate_letters = document.getElementById("plateLetters").value;
    const membership = document.getElementById("membership").value;

    const res = await apiPost({
        action: "addCar",
        phone,
        car,
        plate_numbers,
        plate_letters,
        membership
    });

    if (!res.success) {
        btn.disabled = false;
        btn.innerText = "إضافة السيارة";
        alert("لم يتم الإضافة");
        return;
    }

    btn.innerText = "تم ✔";
    setTimeout(() => window.location.href = "customer-cars.html", 300);
}

window.onload = () => {
    loadMembership();
};
</script>

</body>
</html>
