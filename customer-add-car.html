<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>إضافة سيارة</title>
<script src="api.js"></script>

<style>
body {
    font-family: sans-serif;
    background: #f5f5f5;
    padding: 20px;
}
.card {
    background: white;
    padding: 25px;
    border-radius: 12px;
    width: 380px;
    margin: auto;
    box-shadow: 0 0 10px #ddd;
}
input, select, button {
    width: 95%;
    padding: 12px;
    margin: 10px 0;
    border-radius: 8px;
    border: 1px solid #ccc;
    font-size: 16px;
}
button {
    background: #28a745;
    color: white;
    cursor: pointer;
}
button:hover {
    background: #1e7e34;
}
.list-box {
    max-height: 180px;
    overflow-y: auto;
    border: 1px solid #ddd;
    border-radius: 8px;
    background: white;
    display: none;
}
.list-item {
    padding: 10px;
    cursor: pointer;
}
.list-item:hover {
    background: #f0f0f0;
}
.error {
    color: red;
    margin-top: 10px;
}
</style>
</head>

<body>

<div class="card">
    <h2>إضافة سيارة جديدة</h2>

    <!-- بحث السيارة -->
    <input type="text" id="carSearch" placeholder="ابحث عن نوع السيارة...">
    <div id="carList" class="list-box"></div>

    <!-- إذا اختار "أخرى" -->
    <input type="text" id="carOther" placeholder="اكتب نوع السيارة" style="display:none;">

    <!-- الحجم تلقائي -->
    <input type="text" id="size" placeholder="الحجم" readonly>

    <!-- اللوحة -->
    <input type="text" id="numbers" placeholder="أرقام اللوحة (1234)">
    <input type="text" id="letters" placeholder="حروف اللوحة (أ ب ج)">

    <button onclick="addCar()">إضافة السيارة</button>

    <div id="error" class="error"></div>
</div>

<script>
// قاعدة بيانات السيارات + الحجم التلقائي
const carDB = {
    // صغير
    "تويوتا يارس": "صغير",
    "تويوتا كورولا": "صغير",
    "هيونداي إلنترا": "صغير",
    "هوندا سيفيك": "صغير",
    "كيا سيراتو": "صغير",

    // سيدان
    "تويوتا كامري": "سيدان",
    "تويوتا أفالون": "سيدان",
    "هيونداي سوناتا": "سيدان",
    "هوندا أكورد": "سيدان",
    "كيا K5": "سيدان",
    "فورد تورس": "سيدان",

    // SUV صغير
    "كيا سبورتاج": "SUV صغير",
    "هيونداي توسان": "SUV صغير",
    "هوندا CR-V": "SUV صغير",
    "تويوتا راف فور": "SUV صغير",

    // SUV كبير
    "GMC يوكن": "SUV كبير",
    "شفروليه تاهو": "SUV كبير",
    "شفروليه سوبربان": "SUV كبير",
    "تويوتا لاندكروزر": "SUV كبير",
    "تويوتا برادو": "SUV كبير",
    "نيسان باترول": "SUV كبير",

    // فاخر
    "مرسيدس S-Class": "فاخر",
    "BMW الفئة السابعة": "فاخر",
    "لكزس LS": "فاخر",
    "أودي A8": "فاخر",

    // بيك أب
    "تويوتا هايلكس": "بيك-أب",
    "فورد F150": "بيك-أب",
    "رام 1500": "بيك-أب",
    "نيسان نافارا": "بيك-أب",

    // فان
    "تويوتا هايس": "فان",
    "نيسان أورفان": "فان",
    "شفروليه إكسبريس": "فان",

    // أخرى
    "أخرى": "other"
};

const carSearch = document.getElementById("carSearch");
const carList = document.getElementById("carList");
const carOther = document.getElementById("carOther");
const sizeInput = document.getElementById("size");

// عرض القائمة أثناء الكتابة
carSearch.addEventListener("input", () => {
    const text = carSearch.value.trim();
    carList.innerHTML = "";
    carList.style.display = "block";

    Object.keys(carDB).forEach(car => {
        if (car.includes(text) || text === "") {
            const item = document.createElement("div");
            item.className = "list-item";
            item.textContent = car;
            item.onclick = () => selectCar(car);
            carList.appendChild(item);
        }
    });
});

// اختيار السيارة
function selectCar(car) {
    carSearch.value = car;
    carList.style.display = "none";

    if (car === "أخرى") {
        carOther.style.display = "block";
        sizeInput.value = "";
    } else {
        carOther.style.display = "none";
        sizeInput.value = carDB[car];
    }
}

// إضافة السيارة
async function addCar() {
    const phone = localStorage.getItem("phone");

    let car = carSearch.value.trim();
    if (car === "أخرى") {
        car = carOther.value.trim();
    }

    const size = sizeInput.value.trim();
    const numbers = document.getElementById("numbers").value.trim();
    const letters = document.getElementById("letters").value.trim();
    const error = document.getElementById("error");

    if (!car || !size || !numbers || !letters) {
        error.textContent = "الرجاء تعبئة جميع الحقول";
        return;
    }

    const res = await apiPost({
        action: "addCar",
        phone,
        car,
        size,
        letters,
        numbers
    });

    if (!res.success) {
        error.textContent = "حدث خطأ أثناء الإضافة";
        return;
    }

    window.location.href = "customer-cars.html";
}
</script>

</body>
</html>
