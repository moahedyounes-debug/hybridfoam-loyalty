<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø´Ø±Ù</title>

<style>
    body {
        margin: 0;
        font-family: "Tajawal", sans-serif;
        background: #f4f6f9;
        display: flex;
    }

    /* Sidebar */
    #sidebar {
        width: 260px;
        background: #1f2937;
        color: white;
        height: 100vh;
        position: fixed;
        transition: 0.3s;
        overflow-y: auto;
        z-index: 999;
    }

    #sidebar h2 {
        text-align: center;
        padding: 20px 0;
        margin: 0;
        font-size: 22px;
        background: #111827;
    }

    .menu-item {
        padding: 15px 20px;
        cursor: pointer;
        border-bottom: 1px solid rgba(255,255,255,0.05);
        transition: 0.2s;
    }

    .menu-item:hover {
        background: #374151;
    }

    .menu-item.active {
        background: #2563eb;
    }

    /* Content */
    #content {
        margin-right: 260px;
        padding: 25px;
        width: 100%;
        transition: 0.3s;
    }

    .section {
        display: none;
        background: white;
        padding: 20px;
        border-radius: 14px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .section.active {
        display: block;
    }

    /* Toggle Button */
    .toggle-btn {
        position: fixed;
        right: 260px;
        top: 15px;
        background: #2563eb;
        color: white;
        border: none;
        padding: 10px 14px;
        border-radius: 8px;
        cursor: pointer;
        transition: 0.3s;
        z-index: 1000;
    }

    /* Tables */
    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
    }

    table th, table td {
        padding: 12px;
        border-bottom: 1px solid #ddd;
        text-align: right;
    }

    table th {
        background: #f1f5f9;
    }

    /* ============================
       ğŸ“± ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¬ÙˆØ§Ù„
    ============================ */
    @media (max-width: 768px) {

        #sidebar {
            right: -260px;
            top: 0;
            height: 100vh;
            width: 260px;
            position: fixed;
        }

        #sidebar.open {
            right: 0;
        }

        #content {
            margin-right: 0 !important;
            padding: 15px;
        }

        .toggle-btn {
            right: 15px !important;
            top: 15px;
        }

        table {
            display: block;
            overflow-x: auto;
            white-space: nowrap;
        }
    }
</style>
</head>

<body>

<!-- Sidebar -->
<div id="sidebar">
    <h2>Ø§Ù„Ø¥Ø¯Ø§Ø±Ø©</h2>

    <div class="menu-item active" onclick="showSection('dashboard')">Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</div>
    <div class="menu-item" onclick="showSection('customers')">Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</div>
    <div class="menu-item" onclick="showSection('cars')">Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</div>
    <div class="menu-item" onclick="showSection('employees')">Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</div>
    <div class="menu-item" onclick="showSection('bookings')">Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª</div>
    <div class="menu-item" onclick="showSection('services')">Ø§Ù„Ø®Ø¯Ù…Ø§Øª</div>
    <div class="menu-item" onclick="showSection('prices')">Ø§Ù„Ø£Ø³Ø¹Ø§Ø±</div>
    <div class="menu-item" onclick="showSection('branches')">Ø§Ù„ÙØ±ÙˆØ¹</div>
    <div class="menu-item" onclick="showSection('points')">Ø§Ù„Ù†Ù‚Ø§Ø·</div>
    <div class="menu-item" onclick="showSection('subscriptions')">Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª</div>
    <div class="menu-item" onclick="showSection('notifications')">Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</div>
    <div class="menu-item" onclick="showSection('reports')">Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</div>
    <div class="menu-item" onclick="showSection('ownerReport')">ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„Ùƒ</div>
</div>

<!-- Toggle Button -->
<button class="toggle-btn" onclick="toggleSidebar()">â˜°</button>

<!-- Content -->
<div id="content">

    <div id="dashboard" class="section active">
        <h2>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h2>
        <p>Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ ÙÙŠ Ù„ÙˆØ­Ø© Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù†Ø¸Ø§Ù….</p>
    </div>

    <div id="customers" class="section">
        <h2>Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h2>
        <table id="customersTable"></table>
    </div>

    <div id="cars" class="section">
        <h2>Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</h2>
        <table id="carsTable"></table>
    </div>

    <div id="employees" class="section">
        <h2>Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</h2>
        <table id="employeesTable"></table>
    </div>

    <div id="bookings" class="section">
        <h2>Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª</h2>
        <table id="bookingsTable"></table>
    </div>

    <div id="services" class="section">
        <h2>Ø§Ù„Ø®Ø¯Ù…Ø§Øª</h2>
        <div id="servicesList"></div>
    </div>

    <div id="prices" class="section">
        <h2>Ø§Ù„Ø£Ø³Ø¹Ø§Ø±</h2>
        <div id="pricesList"></div>
    </div>

    <div id="branches" class="section">
        <h2>Ø§Ù„ÙØ±ÙˆØ¹</h2>
        <div id="branchesList"></div>
    </div>

    <div id="points" class="section">
        <h2>Ø§Ù„Ù†Ù‚Ø§Ø·</h2>
        <div id="pointsList"></div>
    </div>

    <div id="subscriptions" class="section">
        <h2>Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØ§Øª</h2>
        <div id="subscriptionsList"></div>
    </div>

    <div id="notifications" class="section">
        <h2>Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª</h2>
        <div id="notificationsList"></div>
    </div>

    <div id="reports" class="section">
        <h2>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</h2>
        <div id="reportsList"></div>
    </div>
<div id="ownerReport" class="section">
    <h2>ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„Ùƒ â€“ Ù…Ù„Ø®Øµ Ø¹Ø§Ù„ÙŠ</h2>

    <div style="margin-top: 15px; display: flex; gap: 10px; flex-wrap: wrap;">
        <select id="filterBranch" onchange="loadOwnerReport()" style="padding: 8px; border-radius: 8px;">
            <option value="">ÙƒÙ„ Ø§Ù„ÙØ±ÙˆØ¹</option>
        </select>

        <select id="filterCarType" onchange="loadOwnerReport()" style="padding: 8px; border-radius: 8px;">
            <option value="">ÙƒÙ„ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</option>
        </select>
    </div>

    <div style="margin-top: 20px; display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
        
        <div class="card">
            <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª</h3>
            <p id="orRevenue">-</p>
        </div>

        <div class="card">
            <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª</h3>
            <p id="orBookings">-</p>
        </div>

        <div class="card">
            <h3>Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h3>
            <p id="orCustomers">-</p>
        </div>

        <div class="card">
            <h3>Ù…ØªÙˆØ³Ø· Ù‚ÙŠÙ…Ø© Ø§Ù„ÙØ§ØªÙˆØ±Ø©</h3>
            <p id="orAvgInvoice">-</p>
        </div>

    </div>

    <h3 style="margin-top: 25px;">ØªÙØ§ØµÙŠÙ„ Ø¥Ø¶Ø§ÙÙŠØ©</h3>
<h3 style="margin-top: 30px;">Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ©</h3>

<div style="margin-top: 20px; display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">

    <div class="card">
        <h4>Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø£ÙŠØ§Ù…</h4>
        <canvas id="chartBookings"></canvas>
    </div>

    <div class="card">
        <h4>Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø£ÙŠØ§Ù…</h4>
        <canvas id="chartRevenue"></canvas>
    </div>

    <div class="card">
        <h4>Ø£ÙØ¶Ù„ Ø§Ù„ÙØ±ÙˆØ¹</h4>
        <canvas id="chartBranches"></canvas>
    </div>

    <div class="card">
        <h4>Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø£ÙƒØ«Ø± Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‹Ø§</h4>
        <canvas id="chartCarTypes"></canvas>
    </div>

</div>
    <div style="margin-top: 15px; display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">

        <div class="card">
            <h4>Ø£ÙØ¶Ù„ ÙØ±Ø¹</h4>
            <p id="orBestBranch">-</p>
        </div>

        <div class="card">
            <h4>Ø£ÙØ¶Ù„ Ø®Ø¯Ù…Ø©</h4>
            <p id="orBestService">-</p>
        </div>

        <div class="card">
            <h4>Ø£ÙØ¶Ù„ Ù…ÙˆØ¸Ù</h4>
            <p id="orBestEmployee">-</p>
        </div>

        <div class="card">
            <h4>Ø£ÙØ¶Ù„ Ù†ÙˆØ¹ Ø³ÙŠØ§Ø±Ø©</h4>
            <p id="orBestCarType">-</p>
        </div>

        <div class="card">
            <h4>Ø£Ø¹Ù„Ù‰ Ø¹Ù…ÙŠÙ„ Ù†Ù‚Ø§Ø·Ù‹Ø§</h4>
            <p id="orTopPoints">-</p>
        </div>

    </div>

</div>

<style>
.card {
    background: white;
    padding: 15px;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}
.card h3, .card h4 {
    margin: 0 0 8px 0;
    font-size: 15px;
    color: #555;
}
.card p {
    font-size: 22px;
    font-weight: bold;
    margin: 0;
}
</style>
</div>

<script src="api.js"></script>

<script>

function toggleSidebar() {
    const sidebar = document.getElementById("sidebar");

    if (window.innerWidth <= 768) {
        sidebar.classList.toggle("open");
    } else {
        sidebar.classList.toggle("collapsed");
    }
}

function showSection(id) {
    document.querySelectorAll(".section").forEach(s => s.classList.remove("active"));
    document.getElementById(id).classList.add("active");

    document.querySelectorAll(".menu-item").forEach(m => m.classList.remove("active"));
    event.target.classList.add("active");

    if (window.innerWidth <= 768) {
        document.getElementById("sidebar").classList.remove("open");
    }
}
async function loadOwnerReport() {
    const branch = document.getElementById("filterBranch").value;
    const carType = document.getElementById("filterCarType").value;

    const res = await apiGet({
        action: "getOwnerReport",
        branch,
        carType
    });

    if (!res.success) {
        console.error("Error loading owner report");
        return;
    }

    fillBranches(res.branches || []);
    fillCarTypes(res.car_types || []);

    document.getElementById("orRevenue").textContent = res.revenue || 0;
    document.getElementById("orBookings").textContent = res.bookings || 0;
    document.getElementById("orCustomers").textContent = res.customers || 0;
    document.getElementById("orAvgInvoice").textContent = res.avg_invoice || 0;

    document.getElementById("orBestBranch").textContent = res.best_branch || "-";
    document.getElementById("orBestService").textContent = res.best_service || "-";
    document.getElementById("orBestEmployee").textContent = res.best_employee || "-";
    document.getElementById("orBestCarType").textContent = res.best_car_type || "-";
    document.getElementById("orTopPoints").textContent = res.top_points_customer || "-";

    // ====== Ø§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ© ======

    // 1) Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø£ÙŠØ§Ù…
    if (res.chart_bookings) {
        renderChart(
            "chartBookings",
            res.chart_bookings.labels,
            res.chart_bookings.data,
            "Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª",
            "#2563eb"
        );
    }

    // 2) Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ø£ÙŠØ§Ù…
    if (res.chart_revenue) {
        renderChart(
            "chartRevenue",
            res.chart_revenue.labels,
            res.chart_revenue.data,
            "Ø§Ù„Ø¥ÙŠØ±Ø§Ø¯Ø§Øª",
            "#16a34a"
        );
    }

    // 3) Ø£ÙØ¶Ù„ Ø§Ù„ÙØ±ÙˆØ¹
    if (res.chart_branches) {
        renderBarChart(
            "chartBranches",
            res.chart_branches.labels,
            res.chart_branches.data,
            "Ø§Ù„ÙØ±ÙˆØ¹",
            "#f59e0b"
        );
    }

    // 4) Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª
    if (res.chart_car_types) {
        renderBarChart(
            "chartCarTypes",
            res.chart_car_types.labels,
            res.chart_car_types.data,
            "Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª",
            "#dc2626"
        );
    }
}
    let chartBookings, chartRevenue, chartBranches, chartCarTypes;

function renderChart(canvasId, labels, data, label, color) {
    const ctx = document.getElementById(canvasId).getContext("2d");

    if (window[canvasId]) {
        window[canvasId].destroy();
    }

    window[canvasId] = new Chart(ctx, {
        type: "line",
        data: {
            labels: labels,
            datasets: [{
                label: label,
                data: data,
                borderColor: color,
                backgroundColor: color + "33",
                borderWidth: 2,
                tension: 0.3,
                fill: true
            }]
        },
        options: {
            responsive: true,
            plugins: { legend: { display: false } }
        }
    });
}

function renderBarChart(canvasId, labels, data, label, color) {
    const ctx = document.getElementById(canvasId).getContext("2d");

    if (window[canvasId]) {
        window[canvasId].destroy();
    }

    window[canvasId] = new Chart(ctx, {
        type: "bar",
        data: {
            labels: labels,
            datasets: [{
                label: label,
                data: data,
                backgroundColor: color + "AA",
                borderColor: color,
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            plugins: { legend: { display: false } }
        }
    });
}
</script>

</body>
</html>
