<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>لوحة المالك</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link rel="stylesheet" href="dashboard.css">
  <script src="api.js"></script>
</head>

<body>

  <div class="sidebar owner">
    <h3>لوحة المالك</h3>

    <a href="visit-manager.html">إدارة الزيارات</a>
    <a href="customers.html">العملاء</a>
    <a href="cars.html">السيارات</a>
    <a href="bookings.html">الحجوزات</a>
    <a href="employees.html">الموظفين</a>
    <a href="branches.html">الفروع</a>
    <a href="notifications.html">الإشعارات</a>

    <hr>

    <a href="supervisors.html">إدارة المشرفين</a>
    <a href="payroll.html">الرواتب</a>
    <a href="finance-reports.html">التقارير المالية</a>
    <a href="system-settings.html">إعدادات النظام</a>

    <button onclick="logout()">تسجيل خروج</button>
  </div>

  <div class="content">
    <h2>مرحباً مالك رغوة الهجين</h2>

    <div class="cards">
      <div class="card">
        <h3>إجمالي الزيارات</h3>
        <div id="visitsTotal">0</div>
      </div>

      <div class="card">
        <h3>إجمالي الإيرادات</h3>
        <div id="revenueTotal">0 ريال</div>
      </div>

      <div class="card">
        <h3>عدد الفروع</h3>
        <div id="branchesCount">0</div>
      </div>

      <div class="card">
        <h3>عدد الموظفين</h3>
        <div id="employeesCount">0</div>
      </div>
    </div>
  </div>

<script>
async function loadOwnerDashboard(){
  const visits = await apiGet({ action:"getAll", sheet:"Visits" });
  const branches = await apiGet({ action:"getAll", sheet:"Branches" });
  const employees = await apiGet({ action:"getAll", sheet:"Employees" });

  let revenue = 0;
  visits.rows.forEach(v => revenue += Number(v[2] || 0));

  document.getElementById("visitsTotal").innerText = visits.rows.length;
  document.getElementById("revenueTotal").innerText = revenue + " ريال";
  document.getElementById("branchesCount").innerText = branches.rows.length;
  document.getElementById("employeesCount").innerText = employees.rows.length;
}

function logout(){
  localStorage.removeItem("owner");
  window.location.href = "login.html";
}

loadOwnerDashboard();
</script>

</body>
</html>
