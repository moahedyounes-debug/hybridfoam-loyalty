<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>إدارة الزيارات</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="visit-manager.css">
  <script src="api.js"></script>
  <script src="visit-manager.js" defer></script>
</head>

<body>

  <h2>إدارة الزيارات</h2>

  <div class="layout">

    <!-- العمود الأيسر: تسجيل زيارة جديدة -->
    <div>

      <!-- البحث عن العميل -->
      <div class="box">
        <h3>بحث عن العميل</h3>

        <label>رقم الجوال</label>
        <input type="text" id="phone" placeholder="05XXXXXXXX"
               oninput="this.value=this.value.replace(/[^0-9]/g,'')">

        <button id="btnSearch" class="btn-primary">
          بحث عن السيارات
        </button>

        <div id="customerInfo" style="margin-top:8px;font-size:13px;color:#ddd;display:none;"></div>
      </div>

      <!-- قائمة السيارات -->
      <div id="carsBox" class="box" style="display:none;">
        <h3>اختر السيارة</h3>
        <div id="carsList"></div>
      </div>

      <!-- تسجيل الزيارة -->
      <div id="visitBox" class="box" style="display:none;">
        <h3>تسجيل زيارة جديدة</h3>

        <div class="row">
          <div>
            <label>نوع الخدمة</label>
            <select id="service_type"></select>
          </div>

          <div>
            <label>تفاصيل الخدمة</label>
            <select id="service_detail"></select>
          </div>
        </div>

        <div class="row">
          <div>
            <label>السعر</label>
            <input type="number" id="price">
          </div>

          <div>
            <label>النقاط</label>
            <input type="number" id="points" readonly>
          </div>
        </div>

        <button id="btnAddService" class="btn-secondary">
          إضافة خدمة +
        </button>

        <div id="servicesList" style="margin-top:10px;"></div>

        <h3 style="margin-top:15px;">الإجمالي: <span id="totalPrice">0</span> ريال</h3>

        <div class="row">
          <div>
            <label>حالة الدفع</label>
            <select id="payment_status">
              <option value="">— اختر حالة الدفع —</option>
              <option value="مدفوع">مدفوع</option>
              <option value="غير مدفوع">غير مدفوع</option>
            </select>
          </div>

          <div>
            <label>طريقة الدفع</label>
            <select id="payment_method">
              <option value="">— اختر طريقة الدفع —</option>
              <option value="كاش">كاش</option>
              <option value="شبكة">شبكة</option>
            </select>
          </div>
        </div>

        <div class="row">
          <div>
            <label>رقم الموقف</label>
            <select id="parking_slot">
              <option value="">— اختر رقم الموقف —</option>
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="5">5</option>
              <option value="6">6</option>
            </select>
          </div>

          <div>
            <label>الفرع</label>
            <select id="branch">
              <option value="">— اختر الفرع —</option>
            </select>
          </div>
        </div>

        <button id="btnSubmitVisit" class="btn-primary">
          تسجيل الزيارة
        </button>

      </div>
    </div>

    <!-- العمود الأيمن: السيارات داخل المغسلة -->
    <div>
      <div class="box">
        <h3>السيارات داخل المغسلة (غير مدفوعة)</h3>

        <div class="active-list" id="activeVisitsList"></div>

        <button id="btnRefreshActive" class="btn-secondary"
                style="width:100%; margin-top:10px;">
          تحديث القائمة
        </button>
      </div>
    </div>

  </div>

</body>
</html>
