<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>بطاقة عضوية رغوة الهجين</title>

<style>
  body {
    font-family: "Tahoma", sans-serif;
    background: #0d0d0d;
    margin: 0;
    padding: 20px;
    text-align: center;
    color: white;
  }

  .card {
    width: 360px;
    margin: 0 auto;
    border-radius: 18px;
    background: #1a1a1a;
    box-shadow: 0 0 20px rgba(255,255,255,0.1);
    overflow: hidden;
    border: 2px solid transparent;
  }

  .vip {
    background: linear-gradient(135deg, #000000, #1a1a1a);
    border: 5px solid #d4af37;
    box-shadow: 0 0 25px rgba(212,175,55,0.4);
  }

  .gold {
    background: linear-gradient(135deg, #d4af37, #b8921b);
    border: 5px solid #000;
  }

  .silver {
    background: linear-gradient(135deg, #c0c0c0, #9e9e9e);
    border: 2px solid #444;
  }

  .bronze {
    background: linear-gradient(135deg, #cd7f32, #a65a1a);
    border: 2px solid #5a3a1a;
  }

  .tier-bar {
    height: 95px;
    font-size: 26px;
    font-weight: bold;
    display: flex;
    justify-content: center;
    align-items: center;
    position: relative;
  }

  .logo {
    width: 80px;
    position: absolute;
    right: 12px;
    top: 8px;
    background: white;
    padding: 5px;
    border-radius: 10px;
    box-shadow: 0 0 6px rgba(0,0,0,0.25);
  }

  .content {
    padding: 20px;
    text-align: right;
    color: white;
  }

  .row {
    margin: 10px 0;
    font-size: 18px;
  }

  .label {
    font-weight: bold;
  }

  .qr-box {
    text-align: center;
    margin: 20px 0;
  }

  .qr-box img {
    width: 110px;
    border-radius: 10px;
    border: 3px solid #d4af37;
  }

  .small-link {
    margin-top: 15px;
    font-size: 14px;
    color: #d4af37;
    cursor: pointer;
    text-decoration: underline;
  }

  .visit-box {
    width: 360px;
    margin: 0 auto;
    padding: 20px;
    background: rgba(255,255,255,0.06);
    border-radius: 16px;
    border: 1px solid rgba(212,175,55,0.4);
    display: none;
  }

  .back-btn {
    margin-top: 20px;
    padding: 12px;
    background: #d4af37;
    color: #000;
    border-radius: 10px;
    font-weight: bold;
    cursor: pointer;
  }
</style>
</head>

<body>

<div id="cardContainer"></div>

<div class="small-link" id="loginLink">تسجيل الدخول لمراجعة الزيارات السابقة</div>

<div id="visitBox" class="visit-box"></div>

<script>
const API = "https://script.google.com/macros/s/AKfycbzgBrZRQ-CaJKw3WgFaXbQMR_UgWZUyixTuCQlkgP_zZ1i1dJlVSiO70Pqmb5aKEIi9Vw/exec";

const phone = sessionStorage.getItem("login_phone");
const plate = sessionStorage.getItem("login_plate");

if (!phone || !plate) {
  document.body.innerHTML = "<h2>الرجاء التسجيل أولاً</h2>";
}

loadCard();

function loadCard() {
  fetch(`${API}?action=getByPhone&phone=${phone}`)
    .then(r => r.json())
    .then(data => {
      if (!data.success) return;

      const c = data.customer;

      const level = (c.level || "Bronze").toLowerCase();
      let tierClass = "bronze";
      let tierName = "Bronze";

      if (level.includes("silver")) { tierClass = "silver"; tierName = "Silver"; }
      if (level.includes("gold")) { tierClass = "gold"; tierName = "Gold"; }
      if (level.includes("vip")) { tierClass = "vip"; tierName = "VIP"; }

      const qrURL = `https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${c.membership}`;

      document.getElementById("cardContainer").innerHTML = `
        <div class="card ${tierClass}">
          <div class="tier-bar">
            ${tierName}
            <img src="logo.png" class="logo">
          </div>

          <div class="content">
            <div class="row"><span class="label">الاسم:</span> ${c.name}</div>
            <div class="row"><span class="label">رقم العضوية:</span> ${c.membership}</div>
            <div class="row"><span class="label">رقم الجوال:</span> ${c.phone.replace("'", "")}</div>
            <div class="row"><span class="label">السيارة:</span> ${c.car}</div>
            <div class="row"><span class="label">اللوحة:</span> ${c.plate_numbers} - ${c.plate_letters}</div>

            <div class="qr-box">
              <img src="${qrURL}">
            </div>
          </div>
        </div>
      `;
    });
}

document.getElementById("loginLink").onclick = () => {
  fetch(`${API}?action=getByPhone&phone=${phone}`)
    .then(r => r.json())
    .then(data => {
      if (!data.success) return;

      const c = data.customer;

      document.getElementById("visitBox").style.display = "block";
      document.getElementById("visitBox").innerHTML = `
        <h2>سجل الزيارات</h2>
        <div class="row"><span class="label">آخر زيارة:</span> ${c.last_visit || "-"}</div>
        <div class="row"><span class="label">عدد الزيارات:</span> ${c.visit_count || 0}</div>
        <div class="row"><span class="label">النقاط:</span> ${c.points || 0}</div>
        <div class="row"><span class="label">المستوى:</span> ${c.level || "Bronze"}</div>
        <div class="row"><span class="label">غسلة مجانية:</span> ${c.free_wash || "-"}</div>

        <div class="back-btn" onclick="showCard()">إظهار البطاقة</div>
      `;
    });
};

function showCard() {
  document.getElementById("visitBox").style.display = "none";
  loadCard();
}
</script>

</body>
</html>
