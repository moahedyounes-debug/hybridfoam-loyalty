<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø¹Ø¶ÙˆÙŠØ©</title>

<style>
    body {
        font-family: sans-serif;
        background: #f5f5f5;
        padding: 20px;
        margin: 0;
        max-width: 600px;
        margin: auto;
    }

    .back-btn {
        background: #000;
        color: white;
        padding: 12px 16px;
        border-radius: 10px;
        display: inline-block;
        margin-bottom: 20px;
        cursor: pointer;
    }

    .card {
        background: white;
        padding: 25px;
        border-radius: 18px;
        box-shadow: 0 3px 10px rgba(0,0,0,0.15);
        text-align: center;
    }

    .title {
        font-size: 22px;
        font-weight: bold;
        margin-bottom: 15px;
    }

    .membership-box {
        color: white;
        padding: 20px;
        border-radius: 14px;
        margin-top: 15px;
    }

    .membership-id {
        font-size: 20px;
        font-weight: bold;
        margin-bottom: 8px;
    }

    .level {
        font-size: 20px;
        margin-bottom: 10px;
        font-weight: bold;
    }

    .qr-box {
        margin-top: 20px;
    }

    .info {
        margin-top: 20px;
        text-align: right;
        font-size: 15px;
        color: #444;
    }

    .info div {
        margin-bottom: 6px;
    }
</style>

<script src="api.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
</head>
<body>

<div class="back-btn" onclick="goBack()">Ø±Ø¬ÙˆØ¹</div>

<div class="card">
    <div class="title">Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø¹Ø¶ÙˆÙŠØ©</div>

    <div class="membership-box" id="levelBox">
        <div class="membership-id" id="membershipId">...</div>
        <div class="level" id="custLevel">...</div>

        <div class="qr-box">
            <canvas id="qr"></canvas>
        </div>
    </div>

    <div class="info">
        <div><b>Ø§Ù„Ø§Ø³Ù…:</b> <span id="custName">...</span></div>
        <div><b>Ø§Ù„Ù†Ù‚Ø§Ø·:</b> <span id="custPoints">...</span></div>
        <div><b>Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©:</b> <span id="custCar">...</span></div>
        <div><b>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù…:</b> <span id="joinDate">...</span></div>
    </div>
</div>

<script>
let phone = localStorage.getItem("customer_phone");

if (!phone) {
    alert("ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹");
    window.location.href = "login.html";
}

// -----------------------------
// ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ø¶ÙˆÙŠØ©
// -----------------------------
async function loadMembership() {
    const res = await apiGet({
        action: "getByPhone",
        phone
    });

    if (!res.success) {
        alert("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
        return;
    }

    const c = res.customer;
    const cars = res.cars;

    document.getElementById("custName").textContent = c.name;
    document.getElementById("custPoints").textContent = c.points + " Ù†Ù‚Ø·Ø©";

    // ØªØ­Ø¯ÙŠØ¯ Ù„ÙˆÙ† Ø§Ù„Ù…Ø³ØªÙˆÙ‰
    const box = document.getElementById("levelBox");
    let levelText = c.level;

    if (c.level === "Bronze") box.style.background = "#cd7f32";
    else if (c.level === "Silver") box.style.background = "#c0c0c0";
    else if (c.level === "Gold") box.style.background = "#d4af37";
    else if (c.level === "Platinum") box.style.background = "#e5e4e2";
    else if (c.level === "VIP") {
        box.style.background = "#000";
        levelText = "ðŸ‘‘ VIP";
    }

    document.getElementById("custLevel").textContent = levelText;

    // Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
    if (cars.length > 0) {
        document.getElementById("custCar").textContent =
            cars[0].car + " â€” " + cars[0].plate_numbers + " " + cars[0].plate_letters;

        document.getElementById("membershipId").textContent =
            "Ø±Ù‚Ù… Ø§Ù„Ø¹Ø¶ÙˆÙŠØ©: " + cars[0].membership;
    }

    // QR ÙŠÙ‚Ø±Ø£ Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„
    generateQR(phone);

    document.getElementById("joinDate").textContent = c.join_date || "â€”";
}

// -----------------------------
// ØªÙˆÙ„ÙŠØ¯ QR Code
// -----------------------------
function generateQR(text) {
    new QRious({
        element: document.getElementById("qr"),
        value: text,
        size: 150
    });
}

function goBack() {
    window.location.href = "customer-home.html";
}

loadMembership();
</script>

</body>
</html>
