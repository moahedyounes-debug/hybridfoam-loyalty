<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø¹Ø¶ÙˆÙŠØ©</title>

<style>
    body {
        font-family: sans-serif;
        background: #f5f5f5;
        padding: 20px;
        margin: 0;
        max-width: 600px;
        margin: auto;
        text-align: center;
    }

    .back-btn {
        background: #000;
        color: white;
        padding: 12px 16px;
        border-radius: 10px;
        display: inline-block;
        margin-bottom: 20px;
        cursor: pointer;
    }

    .card {
        padding: 25px;
        border-radius: 20px;
        color: white;
        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        margin-top: 20px;
    }

    .level-title {
        font-size: 26px;
        font-weight: bold;
        margin-bottom: 10px;
        display: flex;
        justify-content: center;
        align-items: center;
        gap: 8px;
    }

    .crown {
        font-size: 28px;
    }

    .info {
        font-size: 18px;
        margin: 6px 0;
    }

    #qr {
        margin-top: 20px;
        background: white;
        padding: 10px;
        border-radius: 10px;
    }
</style>

<script src="api.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>
</head>
<body>

<div class="back-btn" onclick="goBack()">Ø±Ø¬ÙˆØ¹</div>

<div id="card" class="card">
    <div class="level-title" id="levelTitle">...</div>

    <div class="info" id="custName">...</div>
    <div class="info" id="custMembership">...</div>
    <div class="info" id="custPoints">...</div>
    <div class="info" id="custVisit">...</div>
    <div class="info" id="custFree">...</div>
    <div class="info" id="custSub">...</div>

    <canvas id="qr"></canvas>
</div>

<script>
let phone = localStorage.getItem("customer_phone");

if (!phone) {
    alert("ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹");
    window.location.href = "login.html";
}

// -----------------------------
// ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„
// -----------------------------
async function loadCard() {
    const res = await apiGet({
        action: "getByPhone",
        phone
    });

    if (!res.success) {
        alert("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª");
        return;
    }

    const c = res.customer;

    // Ù†ØµÙˆØµ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©
    document.getElementById("custName").textContent = "Ø§Ù„Ø§Ø³Ù…: " + c.name;
    document.getElementById("custMembership").textContent = "Ø±Ù‚Ù… Ø§Ù„Ø¹Ø¶ÙˆÙŠØ©: " + c.membership;
    document.getElementById("custPoints").textContent = "Ø§Ù„Ù†Ù‚Ø§Ø·: " + c.points;
    document.getElementById("custVisit").textContent = "Ø¢Ø®Ø± Ø²ÙŠØ§Ø±Ø©: " + (c.last_visit || "-");
    document.getElementById("custFree").textContent = "ØºØ³Ù„Ø© Ù…Ø¬Ø§Ù†ÙŠØ©: " + (c.free_wash ? "Ù…Ø³ØªØ­Ù‚" : "ØºÙŠØ± Ù…Ø³ØªØ­Ù‚");
    document.getElementById("custSub").textContent = "Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ: " + (c.subscription || "Ù„Ø§ ÙŠÙˆØ¬Ø¯");

    // Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø¹Ø¶ÙˆÙŠØ©
    const level = c.level;
    const title = document.getElementById("levelTitle");
    const card = document.getElementById("card");

    if (level === "Bronze") {
        title.textContent = "Bronze";
        card.style.background = "#b87333";
    } 
    else if (level === "Silver") {
        title.textContent = "Silver";
        card.style.background = "#C0C0C0";
    } 
    else if (level === "Gold") {
        title.textContent = "Gold";
        card.style.background = "#D4AF37";
    } 
    else if (level === "VIP") {
        title.innerHTML = `<span class="crown">ğŸ‘‘</span> VIP`;
        card.style.background = "#000";
    }

    // QR Code = Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„
    new QRious({
        element: document.getElementById("qr"),
        value: phone,
        size: 200
    });
}

function goBack() {
    window.location.href = "customer-home.html";
}

loadCard();
</script>

</body>
</html>
