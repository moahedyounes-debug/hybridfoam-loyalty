<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>بطاقة العضوية</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body {
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    background: radial-gradient(circle at top, #1e293b 0, #020617 45%, #000 100%);
    color: #f9fafb;
    margin: 0;
    padding: 16px;
    max-width: 480px;
    margin: auto;
  }
  .back-btn {
    background: #111827;
    color: #fff;
    padding: 10px 14px;
    border-radius: 10px;
    display: inline-block;
    margin-bottom: 16px;
    cursor: pointer;
    font-size: 14px;
  }
  .card {
    border-radius: 24px;
    padding: 18px;
    background: linear-gradient(135deg, #0f172a, #1d4ed8);
    box-shadow: 0 18px 40px rgba(0,0,0,0.6);
    color: #f9fafb;
    position: relative;
    overflow: hidden;
  }
  .card-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 14px;
  }
  .brand {
    font-size: 16px;
    font-weight: 600;
  }
  .chip {
    width: 40px;
    height: 28px;
    border-radius: 8px;
    background: rgba(15,23,42,0.8);
  }
  .card-main {
    margin-bottom: 14px;
  }
  .label {
    font-size: 11px;
    opacity: 0.8;
  }
  .value {
    font-size: 16px;
    font-weight: 600;
  }
  .row {
    margin-bottom: 6px;
  }
  .footer {
    display: flex;
    justify-content: space-between;
    align-items: flex-end;
    margin-top: 10px;
  }
  .level-badge {
    padding: 4px 10px;
    border-radius: 999px;
    background: rgba(15,23,42,0.8);
    font-size: 12px;
  }
  .points {
    font-size: 14px;
  }
  .install-box {
    margin-top: 18px;
    background: #020617;
    border-radius: 14px;
    padding: 12px;
    border: 1px solid #1f2937;
    font-size: 13px;
  }
  .install-btn {
    margin-top: 8px;
    width: 100%;
    padding: 10px;
    border-radius: 10px;
    border: none;
    background: #22c55e;
    color: #000;
    font-weight: 600;
    cursor: pointer;
  }
  .hint {
    margin-top: 8px;
    font-size: 12px;
    color: #9ca3af;
  }
</style>
<script src="api.js"></script>
</head>
<body>

<div class="back-btn" onclick="goBack()">رجوع للصفحة الرئيسية</div>

<h2 style="text-align:center;margin-bottom:16px;">بطاقة العضوية</h2>

<div id="cardContainer" class="card">
  <div class="card-header">
    <div class="brand">Raghwa Loyalty</div>
    <div class="chip"></div>
  </div>
  <div class="card-main">
    <div class="row">
      <div class="label">اسم العميل</div>
      <div class="value" id="cName">—</div>
    </div>
    <div class="row">
      <div class="label">رقم العضوية</div>
      <div class="value" id="cMembership">—</div>
    </div>
  </div>
  <div class="footer">
    <div>
      <div class="label">المستوى</div>
      <div class="level-badge" id="cLevel">—</div>
    </div>
    <div class="points">
      <div class="label">النقاط</div>
      <div id="cPoints">0</div>
    </div>
  </div>
</div>

<div class="install-box">
  <b>تثبيت كبطاقة / تطبيق</b>
  <div class="hint">
    - على أجهزة أندرويد (جالكسي): اضغط زر "تثبيت" بالأسفل إن ظهر لك.<br>
    - على الآيفون: من سفاري اختر "إضافة إلى الشاشة الرئيسية" لتظهر كأنها بطاقة.
  </div>
  <button id="installBtn" class="install-btn" style="display:none;">تثبيت على الجهاز</button>
</div>

<script>
let phone = localStorage.getItem("customer_phone");
let deferredPrompt = null;

if (!phone) {
  alert("يرجى تسجيل الدخول أولاً");
  window.location.href = "login.html";
}

async function loadCard() {
  const res = await apiGet({
    action: "getByPhone",
    phone
  });

  if (!res.success) {
    alert("لم يتم العثور على بيانات العميل");
    return;
  }

  const c = res.customer;
  document.getElementById("cName").innerText = c.name || "—";
  document.getElementById("cMembership").innerText = c.membership || "—";
  document.getElementById("cLevel").innerText = c.level || "—";
  document.getElementById("cPoints").innerText = c.points || 0;
}

function goBack() {
  window.location.href = "customer-home.html";
}

// PWA install (أندرويد/كروم)
window.addEventListener("beforeinstallprompt", (e) => {
  e.preventDefault();
  deferredPrompt = e;
  const btn = document.getElementById("installBtn");
  btn.style.display = "block";
  btn.addEventListener("click", async () => {
    if (!deferredPrompt) return;
    deferredPrompt.prompt();
    const choice = await deferredPrompt.userChoice;
    if (choice.outcome === "accepted") {
      deferredPrompt = null;
      btn.style.display = "none";
    }
  });
});

loadCard();
</script>

</body>
</html>
