<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>لوحة المشرف</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
    body {
        margin: 0;
        font-family: "Tajawal", sans-serif;
        background: #f4f6f9;
        display: flex;
    }

    #sidebar {
        width: 260px;
        background: #1f2937;
        color: white;
        height: 100vh;
        position: fixed;
        transition: 0.3s;
        overflow-y: auto;
    }

    #sidebar.collapsed {
        width: 70px;
    }

    #sidebar h2 {
        text-align: center;
        padding: 20px 0;
        margin: 0;
        font-size: 22px;
        background: #111827;
    }

    .menu-item {
        padding: 15px 20px;
        cursor: pointer;
        border-bottom: 1px solid rgba(255,255,255,0.05);
        transition: 0.2s;
    }

    .menu-item:hover {
        background: #374151;
    }

    .menu-item.active {
        background: #2563eb;
    }

    #content {
        margin-right: 260px;
        padding: 25px;
        width: 100%;
        transition: 0.3s;
    }

    #sidebar.collapsed + #content {
        margin-right: 70px;
    }

    .section {
        display: none;
        background: white;
        padding: 20px;
        border-radius: 14px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .section.active {
        display: block;
    }

    .toggle-btn {
        position: fixed;
        right: 260px;
        top: 15px;
        background: #2563eb;
        color: white;
        border: none;
        padding: 10px 14px;
        border-radius: 8px;
        cursor: pointer;
        transition: 0.3s;
    }

    #sidebar.collapsed ~ .toggle-btn {
        right: 70px;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 15px;
    }

    table th, table td {
        padding: 12px;
        border-bottom: 1px solid #ddd;
        text-align: right;
    }

    table th {
        background: #f1f5f9;
    }
</style>
</head>

<body>

<div id="sidebar">
    <h2>الإدارة</h2>

    <div class="menu-item active" onclick="showSection('dashboard', this)">لوحة التحكم</div>
    <div class="menu-item" onclick="showSection('customers', this)">العملاء</div>
    <div class="menu-item" onclick="showSection('cars', this)">السيارات</div>
    <div class="menu-item" onclick="showSection('employees', this)">الموظفين</div>
    <div class="menu-item" onclick="showSection('bookings', this)">الحجوزات</div>
    <div class="menu-item" onclick="showSection('services', this)">الخدمات</div>
    <div class="menu-item" onclick="showSection('prices', this)">الأسعار</div>
    <div class="menu-item" onclick="showSection('branches', this)">الفروع</div>
    <div class="menu-item" onclick="showSection('points', this)">النقاط</div>
    <div class="menu-item" onclick="showSection('subscriptions', this)">الاشتراكات</div>
    <div class="menu-item" onclick="showSection('notifications', this)">الإشعارات</div>
    <div class="menu-item" onclick="showSection('reports', this)">التقارير</div>
    <div class="menu-item" onclick="goOwner()">لوحة المالك</div>
</div>

<button class="toggle-btn" onclick="toggleSidebar()">☰</button>

<div id="content">

    <div id="dashboard" class="section active">
        <h2>لوحة التحكم</h2>
        <p>مرحبًا بك في لوحة إدارة النظام.</p>
    </div>

    <div id="customers" class="section">
        <h2>إدارة العملاء</h2>
        <table id="customersTable">
            <tr><th>الاسم</th><th>الجوال</th><th>العضوية</th></tr>
        </table>
    </div>

    <div id="cars" class="section">
        <h2>إدارة السيارات</h2>
        <table id="carsTable">
            <tr><th>السيارة</th><th>اللوحة</th><th>العميل</th></tr>
        </table>
    </div>

    <div id="employees" class="section">
        <h2>إدارة الموظفين</h2>
        <table id="employeesTable">
            <tr><th>الاسم</th><th>الدور</th><th>الحالة</th></tr>
        </table>
    </div>

    <div id="bookings" class="section">
        <h2>إدارة الحجوزات</h2>
        <table id="bookingsTable">
            <tr><th>الخدمة</th><th>التاريخ</th><th>الحالة</th></tr>
        </table>
    </div>

</div>

<script src="api.js?v=3"></script>

<script>
function toggleSidebar() {
    document.getElementById("sidebar").classList.toggle("collapsed");
}

function showSection(id, el) {
    document.querySelectorAll(".section").forEach(s => s.classList.remove("active"));
    document.getElementById(id).classList.add("active");

    document.querySelectorAll(".menu-item").forEach(m => m.classList.remove("active"));
    el.classList.add("active");

    if (id === "customers") loadCustomers();
    if (id === "cars") loadCars();
    if (id === "employees") loadEmployees();
    if (id === "bookings") loadBookings();
}

async function loadCustomers() {
    const res = await apiGet({ action: "getAllCustomers" });
    if (!res.success) return;

    const table = document.getElementById("customersTable");
    table.innerHTML = `
        <tr><th>الاسم</th><th>الجوال</th><th>العضوية</th></tr>
    `;

    res.customers.forEach(c => {
        table.innerHTML += `
            <tr>
                <td>${c.name}</td>
                <td>${c.phone}</td>
                <td>${c.membership}</td>
            </tr>
        `;
    });
}

async function loadCars() {
    const res = await apiGet({ action: "getAllCars" });
    if (!res.success) return;

    const table = document.getElementById("carsTable");
    table.innerHTML = `
        <tr><th>السيارة</th><th>اللوحة</th><th>العميل</th></tr>
    `;

    res.cars.forEach(c => {
        table.innerHTML += `
            <tr>
                <td>${c.car}</td>
                <td>${c.plate_letters} ${c.plate_numbers}</td>
                <td>${c.customer_name}</td>
            </tr>
        `;
    });
}

async function loadEmployees() {
    const res = await apiGet({ action: "getEmployees" });
    if (!res.success) return;

    const table = document.getElementById("employeesTable");
    table.innerHTML = `
        <tr><th>الاسم</th><th>الدور</th><th>الحالة</th></tr>
    `;

    res.employees.forEach(e => {
        table.innerHTML += `
            <tr>
                <td>${e.name}</td>
                <td>${e.role}</td>
                <td>${e.status}</td>
            </tr>
        `;
    });
}

async function loadBookings() {
    const res = await apiGet({ action: "getAllBookings" });
    if (!res.success) return;

    const table = document.getElementById("bookingsTable");
    table.innerHTML = `
        <tr><th>الخدمة</th><th>التاريخ</th><th>الحالة</th></tr>
    `;

    res.bookings.forEach(b => {
        table.innerHTML += `
            <tr>
                <td>${b.service}</td>
                <td>${b.date}</td>
                <td>${b.status}</td>
            </tr>
        `;
    });
}

function goOwner() {
    window.location.href = "owner-dashboard.html";
}
</script>

</body>
</html>
