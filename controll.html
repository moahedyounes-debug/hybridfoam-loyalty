<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø´Ø±Ù - Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #0f172a; --card: #1e293b; --primary: #3b82f6; --text: #f8fafc; --border: #334155;
        }
        body { font-family: 'Tajawal', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 20px; }
        
        /* Container */
        .container { max-width: 800px; margin: 0 auto; }
        .header { text-align: center; margin-bottom: 30px; }
        .header h1 { margin: 0; color: var(--primary); }
        
        /* Tabs */
        .tabs { display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 1px solid var(--border); padding-bottom: 10px; }
        .tab-btn { background: transparent; color: #94a3b8; border: none; font-size: 16px; padding: 10px 20px; cursor: pointer; border-radius: 6px; font-family: inherit; }
        .tab-btn.active { background: var(--card); color: var(--primary); font-weight: bold; border: 1px solid var(--border); }
        
        /* Cards */
        .card { background: var(--card); border: 1px solid var(--border); border-radius: 12px; padding: 25px; margin-bottom: 20px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); }
        
        /* Forms */
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; color: #94a3b8; font-size: 14px; }
        input, select { width: 100%; padding: 12px; background: #0f172a; border: 1px solid var(--border); color: white; border-radius: 8px; font-size: 16px; box-sizing: border-box; }
        input:focus, select:focus { border-color: var(--primary); outline: none; }
        
        /* Buttons */
        .btn { width: 100%; padding: 14px; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .btn-primary { background: var(--primary); color: white; }
        .btn-primary:hover { background: #2563eb; }
        .btn-secondary { background: #334155; color: white; }
        
        /* Results Area */
        .result-box { background: rgba(59, 130, 246, 0.1); padding: 15px; border-radius: 8px; border: 1px solid var(--primary); display: none; margin-top: 15px; }
        .badge { background: #22c55e; color: white; padding: 2px 8px; border-radius: 4px; font-size: 12px; }

        .hidden { display: none; }
    </style>
</head>
<body>

    <div class="container">
        <div class="header">
            <h1>ğŸ® Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… ÙˆØ§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</h1>
            <p style="color: #94a3b8;">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª ÙˆØ§Ù„Ø¹Ù…Ù„Ø§Ø¡</p>
        </div>

        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('visit')">ØªØ³Ø¬ÙŠÙ„ Ø²ÙŠØ§Ø±Ø©</button>
            <button class="tab-btn" onclick="switchTab('search')">Ø¨Ø­Ø« Ø¹Ù† Ø¹Ù…ÙŠÙ„</button>
            <button class="tab-btn" onclick="switchTab('bookings')">Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª</button>
        </div>

        <div id="tab-visit" class="content-section">
            <div class="card">
                <div class="form-group">
                    <label>Ø±Ù‚Ù… Ø¬ÙˆØ§Ù„ Ø§Ù„Ø¹Ù…ÙŠÙ„</label>
                    <input type="tel" id="vPhone" placeholder="05xxxxxxxx" maxlength="10">
                </div>
                
                <div class="form-group">
                    <label>Ù†ÙˆØ¹ Ø§Ù„Ø®Ø¯Ù…Ø©</label>
                    <select id="vService">
                        <option value="">-- Ø§Ø®ØªØ± Ø§Ù„Ø®Ø¯Ù…Ø© --</option>
                        <optgroup label="ØºØ³ÙŠÙ„ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª">
                            <option value="Ø®Ø§Ø±Ø¬ÙŠ ØµØºÙŠØ±">Ø®Ø§Ø±Ø¬ÙŠ ØµØºÙŠØ±</option>
                            <option value="Ø®Ø§Ø±Ø¬ÙŠ ÙˆØ¯Ø§Ø®Ù„ÙŠ ØµØºÙŠØ±">Ø®Ø§Ø±Ø¬ÙŠ ÙˆØ¯Ø§Ø®Ù„ÙŠ ØµØºÙŠØ±</option>
                            <option value="Ø®Ø§Ø±Ø¬ÙŠ ÙˆØ³Ø·">Ø®Ø§Ø±Ø¬ÙŠ ÙˆØ³Ø·</option>
                            <option value="Ø®Ø§Ø±Ø¬ÙŠ ÙˆØ¯Ø§Ø®Ù„ÙŠ ÙˆØ³Ø·">Ø®Ø§Ø±Ø¬ÙŠ ÙˆØ¯Ø§Ø®Ù„ÙŠ ÙˆØ³Ø·</option>
                            <option value="Ø®Ø§Ø±Ø¬ÙŠ ÙƒØ¨ÙŠØ±">Ø®Ø§Ø±Ø¬ÙŠ ÙƒØ¨ÙŠØ±</option>
                            <option value="Ø®Ø§Ø±Ø¬ÙŠ ÙˆØ¯Ø§Ø®Ù„ÙŠ ÙƒØ¨ÙŠØ±">Ø®Ø§Ø±Ø¬ÙŠ ÙˆØ¯Ø§Ø®Ù„ÙŠ ÙƒØ¨ÙŠØ±</option>
                        </optgroup>
                        <optgroup label="Ø®Ø¯Ù…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©">
                            <option value="ØºØ³ÙŠÙ„ Ù…ÙƒÙŠÙ†Ø©">ØºØ³ÙŠÙ„ Ù…ÙƒÙŠÙ†Ø©</option>
                            <option value="ØªÙ„Ù…ÙŠØ¹ ÙƒÙØ±Ø§Øª">ØªÙ„Ù…ÙŠØ¹ ÙƒÙØ±Ø§Øª</option>
                        </optgroup>
                    </select>
                </div>

                <div class="form-group" style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                    <div>
                        <label>Ø§Ù„Ø³Ø¹Ø± (Ø±.Ø³)</label>
                        <input type="number" id="vPrice" placeholder="0">
                    </div>
                    <div>
                        <label>Ø§Ù„Ù…ÙˆØ¸Ù Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„</label>
                        <select id="vEmployee">
                            <option value="">-- Ø§Ø®ØªØ± --</option>
                            <option value="Ø¹Ø§Ù…">Ù…ÙˆØ¸Ù Ø¹Ø§Ù…</option>
                            <option value="Ù…Ø­Ù…Ø¯">Ù…Ø­Ù…Ø¯</option>
                            <option value="Ø£Ø­Ù…Ø¯">Ø£Ø­Ù…Ø¯</option>
                        </select>
                    </div>
                </div>

                <button class="btn btn-primary" onclick="submitVisit()" id="submitBtn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø²ÙŠØ§Ø±Ø© âœ…</button>
            </div>
        </div>

        <div id="tab-search" class="content-section hidden">
            <div class="card">
                <div class="form-group">
                    <label>Ø¨Ø­Ø« Ø¨Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="tel" id="sPhone" placeholder="05xxxxxxxx">
                        <button class="btn btn-secondary" style="width: 100px;" onclick="searchCustomer()">Ø¨Ø­Ø«</button>
                    </div>
                </div>

                <div id="searchResult" class="result-box">
                    <h3 style="margin-top:0; color: var(--primary);">Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ø­Ø«</h3>
                    <p><strong>Ø§Ù„Ø§Ø³Ù…:</strong> <span id="rName">-</span></p>
                    <p><strong>Ø§Ù„Ø¹Ø¶ÙˆÙŠØ©:</strong> <span id="rMember" class="badge">-</span></p>
                    <p><strong>Ø§Ù„Ø³ÙŠØ§Ø±Ø©:</strong> <span id="rCar">-</span></p>
                    <p><strong>Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù†Ù‚Ø§Ø·:</strong> <span id="rPoints">-</span></p>
                </div>
            </div>
        </div>
        
        <div id="tab-bookings" class="content-section hidden">
            <div class="card">
                <button class="btn btn-secondary" onclick="loadBookings()">ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© ğŸ”„</button>
                <div id="bookingsList" style="margin-top:15px;">
                    <p style="text-align:center; color:#94a3b8">Ø§Ø¶ØºØ· ØªØ­Ø¯ÙŠØ« Ù„Ø¹Ø±Ø¶ Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„ÙŠÙˆÙ…</p>
                </div>
            </div>
        </div>

    </div>

    <script src="api.js"></script>

    <script>
        // --- 1. Ø§Ù„ØªÙ†Ù‚Ù„ Ø¨ÙŠÙ† Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª ---
        function switchTab(tabName) {
            document.querySelectorAll('.content-section').forEach(el => el.classList.add('hidden'));
            document.getElementById('tab-' + tabName).classList.remove('hidden');
            
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }

        // --- 2. ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø²ÙŠØ§Ø±Ø© ---
        async function submitVisit() {
            const btn = document.getElementById('submitBtn');
            const phone = document.getElementById('vPhone').value;
            const service = document.getElementById('vService').value;
            const price = document.getElementById('vPrice').value;
            const employee = document.getElementById('vEmployee').value;

            if (!phone || !service || !price) {
                alert("ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©");
                return;
            }

            // Ø­Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
            btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ³Ø¬ÙŠÙ„...";
            btn.disabled = true;
            btn.style.opacity = "0.7";

            // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… apiPost
            // Ù†Ø³ØªØ®Ø¯Ù… apiPost ÙƒÙ…Ø§ Ù‡Ùˆ Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ Ù…Ù„ÙÙƒ (FormData)
            const result = await apiPost({
                action: "addVisit",
                phone: phone,
                service: service,
                price: price,
                employee: employee,
                date: new Date().toISOString() // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ
            });

            if (result.success || result.status === "success") { // Ø§Ù„ØªØ­Ù‚Ù‚ Ø­Ø³Ø¨ Ø±Ø¯ Ø§Ù„Ù€ Google Script
                alert("âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø²ÙŠØ§Ø±Ø© Ø¨Ù†Ø¬Ø§Ø­!");
                // ØªØµÙÙŠØ± Ø§Ù„Ø­Ù‚ÙˆÙ„
                document.getElementById('vPhone').value = "";
                document.getElementById('vPrice').value = "";
            } else {
                alert("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£: " + (result.error || "ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø´Ø¨ÙƒØ©"));
            }

            // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø²Ø±
            btn.innerText = "ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø²ÙŠØ§Ø±Ø© âœ…";
            btn.disabled = false;
            btn.style.opacity = "1";
        }

        // --- 3. Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø¹Ù…ÙŠÙ„ ---
        async function searchCustomer() {
            const phone = document.getElementById('sPhone').value;
            const resBox = document.getElementById('searchResult');
            
            if(!phone) return;

            resBox.style.display = "none";
            
            // Ø·Ù„Ø¨ GET
            const data = await apiGet({ action: "getCustomerByPhone", phone: phone });

            if (data.success && data.customer) {
                document.getElementById('rName').innerText = data.customer.name || "Ø¶ÙŠÙ";
                document.getElementById('rMember').innerText = data.customer.membership || "Bronze";
                // ØªØ£ÙƒØ¯ Ù…Ù† Ù‡ÙŠÙƒÙ„Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© Ù…Ù† Ø§Ù„Ø³ÙƒØ±Ø¨Øª (Ù‚Ø¯ ØªÙƒÙˆÙ† data.car Ø£Ùˆ Ø¶Ù…Ù† customer)
                document.getElementById('rCar').innerText = data.car ? (data.car.type + " - " + data.car.plate) : "ØºÙŠØ± Ù…Ø³Ø¬Ù„";
                document.getElementById('rPoints').innerText = data.customer.points || 0;
                resBox.style.display = "block";
            } else {
                alert("Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù…");
            }
        }

        // --- 4. ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª ---
        async function loadBookings() {
            const list = document.getElementById('bookingsList');
            list.innerHTML = "Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...";
            
            // Ù†ÙØªØ±Ø¶ Ø£Ù† Ù„Ø¯ÙŠÙƒ Ø¯Ø§Ù„Ø© getBookings ÙÙŠ Ø§Ù„Ø³ÙƒØ±Ø¨Øª
            const today = new Date().toISOString().split('T')[0];
            const data = await apiGet({ action: "getBookings", date: today });

            list.innerHTML = "";
            if (!data.bookings || data.bookings.length === 0) {
                list.innerHTML = "<p style='text-align:center; color:#94a3b8'>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø¬ÙˆØ²Ø§Øª Ø§Ù„ÙŠÙˆÙ…</p>";
                return;
            }

            data.bookings.forEach(b => {
                const item = document.createElement('div');
                item.style.borderBottom = "1px solid #334155";
                item.style.padding = "10px 0";
                item.innerHTML = `
                    <div style="display:flex; justify-content:space-between;">
                        <strong>${b.name || b.phone}</strong>
                        <span class="badge" style="background:${b.status === 'Confirmed' ? '#22c55e' : '#eab308'}">${b.status}</span>
                    </div>
                    <div style="font-size:13px; color:#94a3b8; margin-top:4px;">
                        ${b.service} - ${b.time}
                    </div>
                `;
                list.appendChild(item);
            });
        }
    </script>
</body>
</html>
