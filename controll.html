<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø´Ø±Ù - controll.html</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Flatpickr -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css" />

  <!-- Tailwind-like custom style -->
  <style>
    :root {
      --bg: #020617;
      --bg-soft: #020617;
      --card: #020617;
      --border: #1f2937;
      --accent: #2563eb;
      --accent-soft: #1d4ed8;
      --danger: #dc2626;
      --success: #16a34a;
      --warning: #f59e0b;
      --text-main: #f9fafb;
      --text-muted: #9ca3af;
      --radius-lg: 16px;
      --radius-md: 12px;
      --radius-sm: 8px;
      --shadow-soft: 0 18px 45px rgba(15, 23, 42, 0.7);
      --transition-fast: 0.15s ease-out;
    }

    [data-theme="light"] {
      --bg: #f3f4f6;
      --bg-soft: #ffffff;
      --card: #ffffff;
      --border: #e5e7eb;
      --text-main: #111827;
      --text-muted: #6b7280;
      --shadow-soft: 0 10px 30px rgba(15, 23, 42, 0.12);
    }

    * , *::before , *::after {
      box-sizing: border-box;
    }

    html, body {
      margin: 0;
      padding: 0;
      font-family: "Tajawal", system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #1e293b 0, #020617 45%, #000 100%);
      color: var(--text-main);
      direction: rtl;
    }

    body {
      background-color: var(--bg);
    }

    .layout {
      display: flex;
      min-height: 100vh;
    }

    .sidebar {
      width: 260px;
      background: rgba(15, 23, 42, 0.98);
      border-left: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      padding: 18px 14px;
      gap: 10px;
    }

    [data-theme="light"] .sidebar {
      background: #111827;
      color: #e5e7eb;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
    }

    .brand-logo {
      width: 40px;
      height: 40px;
      border-radius: 14px;
      background: #020617;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }

    .brand-logo img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }

    .brand-text {
      font-size: 18px;
      font-weight: 600;
    }

    .nav-section-title {
      font-size: 11px;
      color: var(--text-muted);
      margin: 10px 4px 4px;
    }

    .nav {
      display: flex;
      flex-direction: column;
      gap: 6px;
      margin-bottom: 6px;
    }

    .nav-btn {
      width: 100%;
      text-align: right;
      padding: 9px 11px;
      border-radius: 10px;
      border: none;
      background: transparent;
      color: var(--text-muted);
      font-size: 14px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: space-between;
      transition: var(--transition-fast);
    }

    .nav-btn span {
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .nav-btn.active {
      background: rgba(37, 99, 235, 0.22);
      color: var(--text-main);
    }

    .nav-btn:hover {
      background: rgba(15, 23, 42, 0.9);
      color: var(--text-main);
    }

    .main {
      flex: 1;
      display: flex;
      flex-direction: column;
      min-width: 0;
      background: radial-gradient(circle at top, #1e293b 0, #020617 45%, #000 100%);
    }

    [data-theme="light"] .main {
      background: #f3f4f6;
    }

    .topbar {
      padding: 12px 18px;
      border-bottom: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: rgba(15, 23, 42, 0.9);
      backdrop-filter: blur(10px);
      position: sticky;
      top: 0;
      z-index: 10;
    }

    [data-theme="light"] .topbar {
      background: #ffffffcc;
      backdrop-filter: blur(12px);
    }

    .topbar-left {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .topbar-title {
      font-size: 16px;
      font-weight: 500;
    }

    .topbar-sub {
      font-size: 12px;
      color: var(--text-muted);
    }

    .stats-bar {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      justify-content: flex-end;
      align-items: center;
    }

    .pill {
      padding: 4px 10px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.9);
      border: 1px solid var(--border);
      font-size: 12px;
      color: var(--text-muted);
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    [data-theme="light"] .pill {
      background: #f9fafb;
    }

    .content {
      padding: 18px;
      display: flex;
      flex-direction: column;
      gap: 18px;
    }

    .section {
      display: none;
    }

    .section.active {
      display: block;
    }

    .card {
      background: var(--card);
      border-radius: var(--radius-lg);
      padding: 16px;
      border: 1px solid var(--border);
      box-shadow: var(--shadow-soft);
    }

    .card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 10px;
      gap: 8px;
    }

    .card-header h2,
    .card-header h3 {
      margin: 0;
      text-align: right;
      font-size: 16px;
    }

    h2, h3 {
      margin: 0 0 10px;
    }

    p {
      margin: 0;
    }

    label {
      display: block;
      font-size: 13px;
      color: var(--text-muted);
      margin-top: 8px;
      margin-bottom: 3px;
    }

    input, select, textarea {
      width: 100%;
      padding: 10px 11px;
      border-radius: var(--radius-md);
      border: 1px solid var(--border);
      background: #020617;
      color: var(--text-main);
      font-size: 14px;
      margin-bottom: 6px;
      outline: none;
      transition: var(--transition-fast);
    }

    [data-theme="light"] input,
    [data-theme="light"] select,
    [data-theme="light"] textarea {
      background: #f9fafb;
    }

    input:focus,
    select:focus,
    textarea:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.4);
    }

    textarea {
      min-height: 90px;
      resize: vertical;
    }

    button {
      padding: 9px 12px;
      border-radius: var(--radius-md);
      border: none;
      background: var(--accent);
      color: white;
      font-size: 13px;
      cursor: pointer;
      position: relative;
      transition: var(--transition-fast);
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    button:active {
      transform: scale(0.97);
    }

    .btn-secondary {
      background: #111827;
      color: var(--text-main);
    }

    .btn-danger {
      background: var(--danger);
    }

    .btn-sm {
      padding: 6px 10px;
      font-size: 12px;
      border-radius: var(--radius-sm);
    }

    button.loading {
      color: transparent !important;
      cursor: wait;
    }

    button.loading::after {
      content: "";
      position: absolute;
      top: 50%;
      left: 50%;
      width: 18px;
      height: 18px;
      margin-top: -9px;
      margin-left: -9px;
      border-radius: 50%;
      border: 2px solid #fff;
      border-top-color: transparent;
      animation: spin 0.7s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .list {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .status-text {
      font-size: 12px;
      color: var(--text-muted);
      margin-top: 6px;
    }

    .grid-2 {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 12px;
    }

    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 12px;
      margin-top: 12px;
    }

    .dash-card {
      background: var(--card);
      border-radius: 14px;
      padding: 12px;
      border: 1px solid var(--border);
      font-size: 13px;
    }

    .dash-card-title {
      font-size: 13px;
      color: var(--text-muted);
      margin-bottom: 6px;
    }

    .dash-card-value {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .bar-row {
      display: flex;
      align-items: center;
      gap: 6px;
      margin-bottom: 4px;
      font-size: 11px;
    }

    .bar-label {
      min-width: 70px;
      color: var(--text-muted);
    }

    .bar-track {
      flex: 1;
      height: 6px;
      border-radius: 999px;
      background: #020617;
      border: 1px solid var(--border);
      overflow: hidden;
    }

    .bar-fill {
      height: 100%;
      background: linear-gradient(90deg, #2563eb, #22c55e);
      width: 0%;
    }

    .topbar-right {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .branch-pill {
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: rgba(15, 23, 42, 0.9);
      font-size: 12px;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    [data-theme="light"] .branch-pill {
      background: #f9fafb;
    }

    .theme-toggle {
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: transparent;
      color: var(--text-muted);
      font-size: 12px;
      cursor: pointer;
    }

    .charts-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 12px;
      margin-top: 12px;
    }

    canvas {
      max-width: 100%;
    }

    @media (max-width: 900px) {
      .layout {
        flex-direction: column;
      }
      .sidebar {
        width: 100%;
        flex-direction: row;
        overflow-x: auto;
        border-left: none;
        border-bottom: 1px solid var(--border);
      }
      .nav {
        flex-direction: row;
        flex-wrap: nowrap;
      }
      .nav-btn {
        white-space: nowrap;
      }
      .topbar {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
      }
      .stats-bar {
        justify-content: flex-start;
      }
    }
  </style>
</head>
<body data-theme="dark">
<div class="layout">
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="brand">
      <div class="brand-logo">
        <img src="logo.png" alt="Logo">
      </div>
      <div class="brand-text">Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø´Ø±Ù</div>
    </div>

    <div class="nav-section-title">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</div>
    <div class="nav">
      <button class="nav-btn active" data-target="dashboard"><span>Dashboard</span></button>
    </div>

    <div class="nav-section-title">Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</div>
    <div class="nav">
      <button class="nav-btn" data-target="customers"><span>Ø¨Ø­Ø« Ø¹Ù…ÙŠÙ„</span></button>
      <button class="nav-btn" data-target="visits"><span>Ø²ÙŠØ§Ø±Ø§Øª Ø§Ù„ÙØ±Ø¹</span></button>
      <button class="nav-btn" data-target="cars"><span>Ø³ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„</span></button>
      <button class="nav-btn" data-target="addVisit"><span>Ø¥Ø¶Ø§ÙØ© Ø²ÙŠØ§Ø±Ø©</span></button>
    </div>

    <div class="nav-section-title">Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª ÙˆØ§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</div>
    <div class="nav">
      <button class="nav-btn" data-target="bookings"><span>Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª</span></button>
      <button class="nav-btn" data-target="reports"><span>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠØ©</span></button>
      <button class="nav-btn" data-target="export"><span>ØªØµØ¯ÙŠØ± Excel</span></button>
    </div>
  </aside>

  <!-- Main -->
  <main class="main">
    <div class="topbar">
      <div class="topbar-left">
        <div class="topbar-title">Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø´Ø±Ù</div>
        <div class="topbar-sub">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ØŒ Ø§Ù„Ø²ÙŠØ§Ø±Ø§ØªØŒ Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª ÙˆØ§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø­Ø³Ø¨ Ø§Ù„ÙØ±Ø¹</div>
      </div>
      <div class="topbar-right">
        <div class="branch-pill">
          Ø§Ù„ÙØ±Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ:
          <span id="currentBranch">â€”</span>
        </div>
        <select id="branchSelect" style="max-width:180px;font-size:12px;"></select>
        <button id="themeToggle" class="theme-toggle">ğŸŒ™ / â˜€</button>
      </div>
    </div>

    <div class="content">
      <!-- Dashboard -->
      <section id="dashboard" class="section active">
        <div class="card">
          <div class="card-header">
            <h2>Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø© Ø¹Ù„Ù‰ Ø§Ù„ÙØ±Ø¹</h2>
          </div>
          <div class="grid-2">
            <div class="dash-card">
              <div class="dash-card-title">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ø§Ù„Øº</div>
              <div class="dash-card-value"><span id="mAmount">0</span> Ø±ÙŠØ§Ù„</div>
              <div class="status-text">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª ÙÙŠ Ø§Ù„ÙØ±Ø¹ Ø§Ù„Ù…Ø­Ø¯Ø¯</div>
            </div>
            <div class="dash-card">
              <div class="dash-card-title">Ù…ØªÙˆØ³Ø· Ø§Ù„Ø¥Ù†ÙØ§Ù‚ Ù„ÙƒÙ„ Ø¹Ù…ÙŠÙ„</div>
              <div class="dash-card-value"><span id="mAvgSpend">0</span> Ø±ÙŠØ§Ù„</div>
              <div class="status-text">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨Ø§Ù„Øº Ã· Ø¹Ø¯Ø¯ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</div>
            </div>
          </div>

          <div class="dashboard-grid">
            <div class="dash-card">
              <div class="dash-card-title">Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø³Ø±ÙŠØ¹Ø©</div>
              <div class="bar-row">
                <div class="bar-label">Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</div>
                <div class="bar-track"><div class="bar-fill" id="barCustomers"></div></div>
              </div>
              <div class="bar-row">
                <div class="bar-label">Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª</div>
                <div class="bar-track"><div class="bar-fill" id="barVisits"></div></div>
              </div>
              <div class="bar-row">
                <div class="bar-label">Ø§Ù„Ù…Ø¨Ø§Ù„Øº</div>
                <div class="bar-track"><div class="bar-fill" id="barAmount"></div></div>
              </div>
            </div>
            <div class="dash-card">
              <div class="dash-card-title">Ù…Ø¤Ø´Ø±Ø§Øª Ø¹Ø§Ù…Ø©</div>
              <p class="status-text">
                ğŸ‘¥ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡: <span id="sCustomers">0</span><br>
                ğŸš— Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª (ØªÙ‚Ø±ÙŠØ¨Ù‹Ø§): <span id="sCars">0</span><br>
                ğŸ§¾ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª: <span id="sVisits">0</span><br>
                ğŸ’° Ø§Ù„Ù…Ø¨Ø§Ù„Øº: <span id="sAmount">0</span> Ø±ÙŠØ§Ù„
              </p>
            </div>
          </div>

          <div class="charts-grid">
            <div class="dash-card">
              <div class="dash-card-title">Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª Ø­Ø³Ø¨ Ø§Ù„ÙŠÙˆÙ…</div>
              <canvas id="visitsPerDayChart" height="140"></canvas>
            </div>
            <div class="dash-card">
              <div class="dash-card-title">Ø£ÙƒØ«Ø± Ø§Ù„Ø®Ø¯Ù…Ø§Øª Ø§Ø³ØªØ®Ø¯Ø§Ù…Ù‹Ø§</div>
              <canvas id="topServicesChart" height="140"></canvas>
            </div>
          </div>
        </div>
      </section>

      <!-- Customers -->
      <section id="customers" class="section">
        <div class="card">
          <div class="card-header">
            <h2>Ø¨Ø­Ø« Ø¹Ù† Ø¹Ù…ÙŠÙ„</h2>
          </div>
          <label>Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„Ø¹Ø¶ÙˆÙŠØ©</label>
          <input id="searchPhone" placeholder="05xxxxxxxx Ø£Ùˆ 2026xxxx" />
          <button id="searchBtn">Ø¨Ø­Ø«</button>
          <div id="searchResult" class="list" style="margin-top:10px;"></div>
        </div>
      </section>

      <!-- Visits -->
      <section id="visits" class="section">
        <div class="card">
          <div class="card-header">
            <h2>Ø²ÙŠØ§Ø±Ø§Øª Ø§Ù„ÙØ±Ø¹</h2>
          </div>
          <div class="grid-2">
            <div>
              <label>Ù…Ù† ØªØ§Ø±ÙŠØ®</label>
              <input id="visitsFrom" class="datePicker" placeholder="YYYY-MM-DD" />
            </div>
            <div>
              <label>Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®</label>
              <input id="visitsTo" class="datePicker" placeholder="YYYY-MM-DD" />
            </div>
          </div>
          <button id="visitsBtn">Ø¹Ø±Ø¶ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª</button>
          <div id="visitsList" class="list" style="margin-top:10px;"></div>
        </div>
      </section>

      <!-- Cars -->
      <section id="cars" class="section">
        <div class="card">
          <div class="card-header">
            <h2>Ø³ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¹Ù…ÙŠÙ„</h2>
          </div>
          <label>Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„</label>
          <input id="carsPhone" placeholder="05xxxxxxxx" />
          <button id="carsBtn">Ø¹Ø±Ø¶ Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª</button>
          <div id="carsList" class="list" style="margin-top:10px;"></div>
        </div>
      </section>

      <!-- Add Visit -->
      <section id="addVisit" class="section">
        <div class="card">
          <div class="card-header">
            <h2>Ø¥Ø¶Ø§ÙØ© Ø²ÙŠØ§Ø±Ø© Ù„Ù„ÙØ±Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ</h2>
          </div>

          <div class="card" style="background:#020617;margin-bottom:10px;">
            <div class="card-header">
              <h3>Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„</h3>
            </div>
            <label>Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ Ø£Ùˆ Ø±Ù‚Ù… Ø§Ù„Ø¹Ø¶ÙˆÙŠØ©</label>
            <input id="visitSearch" placeholder="05xxxxxxxx Ø£Ùˆ 2026xxxx" />
            <button id="visitSearchBtn">Ø¨Ø­Ø«</button>
          </div>

          <div id="visitCarsBox" class="card" style="display:none;background:#020617;margin-bottom:10px;">
            <div class="card-header">
              <h3>Ø§Ø®ØªØ± Ø§Ù„Ø³ÙŠØ§Ø±Ø©</h3>
            </div>
            <div id="visitCarsList" class="list"></div>
          </div>

          <div id="visitForm" class="card" style="display:none;background:#020617;">
            <div class="card-header">
              <h3>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø²ÙŠØ§Ø±Ø©</h3>
            </div>
            <p id="visitSelectedInfo" class="status-text"></p>

            <label>Ø§Ù„Ø®Ø¯Ù…Ø©</label>
            <select id="vService"></select>

            <label>Ø§Ù„Ø³Ø¹Ø±</label>
            <input type="number" id="vPrice" />

            <label>Ø§Ù„Ù†Ù‚Ø§Ø·</label>
            <input type="number" id="vPoints" readonly />

            <button id="addVisitBtn">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø²ÙŠØ§Ø±Ø©</button>
            <p id="addVisitStatus" class="status-text"></p>
          </div>
        </div>
      </section>

      <!-- Bookings -->
      <section id="bookings" class="section">
        <div class="card">
          <div class="card-header">
            <h2>Ø§Ù„Ø­Ø¬ÙˆØ²Ø§Øª</h2>
          </div>
          <label>Ø§Ø®ØªØ± Ø§Ù„ØªØ§Ø±ÙŠØ® (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
          <input id="bookingsDate" class="datePicker" placeholder="YYYY-MM-DD" />
          <div id="bookingsList" class="list" style="margin-top:10px;">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
        </div>
      </section>

      <!-- Reports -->
      <section id="reports" class="section">
        <div class="card">
          <div class="card-header">
            <h2>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± Ø§Ù„Ù…Ø§Ù„ÙŠØ© Ø­Ø³Ø¨ Ø§Ù„ÙØ±Ø¹</h2>
          </div>
          <div class="grid-2">
            <div>
              <label>Ù…Ù† ØªØ§Ø±ÙŠØ®</label>
              <input id="reportsFrom" class="datePicker" placeholder="YYYY-MM-DD" />
            </div>
            <div>
              <label>Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®</label>
              <input id="reportsTo" class="datePicker" placeholder="YYYY-MM-DD" />
            </div>
          </div>
          <button id="reportsBtn">Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø±ÙŠØ±</button>
          <div id="reportsList" class="list" style="margin-top:10px;"></div>
        </div>
      </section>

      <!-- Export -->
      <section id="export" class="section">
        <div class="card">
          <div class="card-header">
            <h2>ØªØµØ¯ÙŠØ± Excel (ÙŠÙˆÙ…ÙŠ / Ø´Ù‡Ø±ÙŠ)</h2>
          </div>
          <div class="grid-2">
            <div>
              <label>Ù…Ù† ØªØ§Ø±ÙŠØ®</label>
              <input id="exportFrom" class="datePicker" placeholder="YYYY-MM-DD" />
            </div>
            <div>
              <label>Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®</label>
              <input id="exportTo" class="datePicker" placeholder="YYYY-MM-DD" />
            </div>
          </div>
          <button id="exportBtn">ØªØµØ¯ÙŠØ± Excel</button>
          <p class="status-text">Ø³ÙŠØªÙ… ØªØµØ¯ÙŠØ± ØªÙ‚Ø±ÙŠØ± ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰: Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ØŒ Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ØŒ Ù†ÙˆØ¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø©ØŒ Ù†ÙˆØ¹ Ø§Ù„Ø®Ø¯Ù…Ø©ØŒ Ø§Ù„Ù…Ø¨Ù„ØºØŒ Ø§Ù„Ø¹Ù…ÙˆÙ„Ø©ØŒ Ø±Ù‚Ù… Ø§Ù„Ø¹Ø¶ÙˆÙŠØ©ØŒ Ø§Ù„ØªØ§Ø±ÙŠØ®ØŒ Ø§Ù„Ù…ÙˆØ¸ÙØŒ Ø§Ù„ÙØ±Ø¹.</p>
        </div>
      </section>
    </div>
  </main>
</div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
<script src="api.js?v=3"></script>

<script>
  const $ = (id) => document.getElementById(id);

  function setLoading(btn, state = true) {
    if (!btn) return;
    if (state) {
      btn.classList.add("loading");
      btn.disabled = true;
    } else {
      btn.classList.remove("loading");
      btn.disabled = false;
    }
  }

  function formatDateOnly(d) {
    if (!d) return "";
    const dt = new Date(d);
    return dt.toISOString().slice(0, 10);
  }

  // THEME
  (function initTheme() {
    const saved = localStorage.getItem("sup_theme") || "dark";
    document.body.setAttribute("data-theme", saved);
    $("themeToggle").addEventListener("click", () => {
      const current = document.body.getAttribute("data-theme");
      const next = current === "dark" ? "light" : "dark";
      document.body.setAttribute("data-theme", next);
      localStorage.setItem("sup_theme", next);
    });
  })();

  // TABS
  (function initTabs() {
    const sections = document.querySelectorAll(".section");
    const navButtons = document.querySelectorAll(".nav-btn");
    navButtons.forEach(btn => {
      btn.addEventListener("click", () => {
        const target = btn.dataset.target;
        sections.forEach(s => s.classList.remove("active"));
        document.getElementById(target).classList.add("active");
        navButtons.forEach(b => b.classList.remove("active"));
        btn.classList.add("active");
      });
    });
  })();

  // DATE PICKERS
  (function initDatePickers() {
    const options = { dateFormat: "Y-m-d", allowInput: true };
    flatpickr("#visitsFrom", options);
    flatpickr("#visitsTo", options);
    flatpickr("#bookingsDate", options);
    flatpickr("#reportsFrom", options);
    flatpickr("#reportsTo", options);
    flatpickr("#exportFrom", options);
    flatpickr("#exportTo", options);
  })();

  // BRANCHES
  let currentBranch = null;
  let branchesList = [];

  async function loadBranches() {
    const res = await apiGet({ action: "getBranches" });
    branchesList = res.branches || [];

    const select = $("branchSelect");
    select.innerHTML = "";

    branchesList.forEach(b => {
      const opt = document.createElement("option");
      opt.value = b.branch;
      opt.textContent = `${b.branch} â€” ${b.city}`;
      select.appendChild(opt);
    });

    const saved = localStorage.getItem("supervisor_branch");
    if (saved && branchesList.find(b => b.branch === saved)) {
      currentBranch = saved;
      select.value = saved;
    } else {
      currentBranch = branchesList.length ? branchesList[0].branch : null;
      select.value = currentBranch;
    }

    $("currentBranch").textContent = currentBranch || "â€”";

    select.addEventListener("change", () => {
      currentBranch = select.value;
      localStorage.setItem("supervisor_branch", currentBranch);
      $("currentBranch").textContent = currentBranch;
      loadDashboard();
      loadBookings();
    });
  }

  // DASHBOARD
  let visitsChart = null;
  let servicesChart = null;

  async function loadDashboard() {
    if (!currentBranch) return;

    const fromDate = "2000-01-01T00:00:00.000Z";
    const toDate = "2100-01-01T23:59:59.000Z";

    const res = await apiGet({
      action: "getVisitsByDate",
      from: fromDate,
      to: toDate
    });

    const visits = (res.visits || []).filter(v => v.branch === currentBranch);

    const totalAmount = visits.reduce((s, v) => s + Number(v.price || 0), 0);
    const totalVisits = visits.length;
    const customersSet = new Set(visits.map(v => v.membership));
    const customers = customersSet.size;
    const avgSpend = customers ? (totalAmount / customers).toFixed(1) : 0;

    $("sAmount").textContent = totalAmount;
    $("sVisits").textContent = totalVisits;
    $("sCustomers").textContent = customers;
    $("sCars").textContent = customers;

    $("mAmount").textContent = totalAmount;
    $("mAvgSpend").textContent = avgSpend;

    const maxVisits = 200;
    const maxAmount = 50000;
    const maxCustomers = 200;

    $("barCustomers").style.width = Math.min(100, (customers / maxCustomers) * 100) + "%";
    $("barVisits").style.width = Math.min(100, (totalVisits / maxVisits) * 100) + "%";
    $("barAmount").style.width = Math.min(100, (totalAmount / maxAmount) * 100) + "%";

    renderVisitsChart(visits);
    renderServicesChart(visits);
  }

  function renderVisitsChart(visits) {
    const ctx = $("visitsPerDayChart").getContext("2d");
    const map = {};
    visits.forEach(v => {
      const d = formatDateOnly(v.date);
      map[d] = (map[d] || 0) + 1;
    });
    const labels = Object.keys(map).sort();
    const data = labels.map(l => map[l]);

    if (visitsChart) visitsChart.destroy();

    visitsChart = new Chart(ctx, {
      type: "line",
      data: {
        labels,
        datasets: [{
          label: "Ø¹Ø¯Ø¯ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª",
          data,
          borderColor: "#2563eb",
          backgroundColor: "rgba(37,99,235,0.2)",
          fill: true,
          tension: 0.3
        }]
      },
      options: {
        responsive: true,
        plugins: { legend: { display: false } },
        scales: {
          x: { ticks: { autoSkip: true, maxTicksLimit: 7 } }
        }
      }
    });
  }

  function renderServicesChart(visits) {
    const ctx = $("topServicesChart").getContext("2d");
    const map = {};
    visits.forEach(v => {
      const s = v.service || "ØºÙŠØ± Ù…Ø­Ø¯Ø¯";
      map[s] = (map[s] || 0) + 1;
    });
    const sorted = Object.entries(map).sort((a, b) => b[1] - a[1]).slice(0, 6);
    const labels = sorted.map(s => s[0]);
    const data = sorted.map(s => s[1]);

    if (servicesChart) servicesChart.destroy();

    servicesChart = new Chart(ctx, {
      type: "bar",
      data: {
        labels,
        datasets: [{
          label: "Ø¹Ø¯Ø¯ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª",
          data,
          backgroundColor: "#f59e0b"
        }]
      },
      options: {
        responsive: true,
        plugins: { legend: { display: false } }
      }
    });
  }

  // SMART CUSTOMER SEARCH
  async function smartSearchCustomer(query) {
    if (query.startsWith("05") && query.length === 10) {
      const res = await apiGet({ action: "getByPhone", phone: query });
      if (!res.success) return null;
      return { customers: [res.customer], cars: res.cars || [] };
    }
    if (/^\d+$/.test(query)) {
      const res = await apiGet({ action: "getByMembership", membership: query });
      if (!res.success) return null;
      const cars = [];
      if (res.car) cars.push(res.car);
      return { customers: res.customer ? [res.customer] : [], cars };
    }
    return null;
  }

  // CUSTOMERS
  async function handleCustomerSearch() {
    const btn = $("searchBtn");
    const query = $("searchPhone").value.trim();
    if (!query) return alert("Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ Ø£Ùˆ Ø§Ù„Ø¹Ø¶ÙˆÙŠØ©");

    setLoading(btn, true);
    const data = await smartSearchCustomer(query);
    setLoading(btn, false);

    const box = $("searchResult");
    box.innerHTML = "";

    if (!data || !data.customers.length) {
      box.innerHTML = "<p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</p>";
      return;
    }

    const c = data.customers[0];
    box.innerHTML = `
      <div class="card">
        Ø§Ù„Ø§Ø³Ù…: ${c.name}<br>
        Ø§Ù„Ø¬ÙˆØ§Ù„: ${c.phone}<br>
        Ø§Ù„Ø¹Ø¶ÙˆÙŠØ©: ${c.membership}<br>
        Ø§Ù„Ù†Ù‚Ø§Ø·: ${c.points}<br>
        Ø§Ù„Ù…Ø³ØªÙˆÙ‰: ${c.level}<br>
        Ø¢Ø®Ø± Ø²ÙŠØ§Ø±Ø©: ${c.last_visit || "â€”"}<br>
        Ø¹Ø¯Ø¯ Ø§Ù„Ø²ÙŠØ§Ø±Ø§Øª: ${c.visit_count}
      </div>
    `;
  }

  // VISITS
  async function handleLoadVisits() {
    if (!currentBranch) return alert("Ø§Ø®ØªØ± Ø§Ù„ÙØ±Ø¹ Ø£ÙˆÙ„Ø§Ù‹");

    const btn = $("visitsBtn");
    const from = $("visitsFrom").value.trim();
    const to = $("visitsTo").value.trim();

    setLoading(btn, true);

    let fromDate, toDate;
    if (!from && !to) {
      fromDate = "2000-01-01T00:00:00.000Z";
      toDate = "2100-01-01T23:59:59.000Z";
    } else {
      const f = from || to;
      const t = to || from;
      fromDate = new Date(f + "T00:00:00").toISOString();
      toDate = new Date(t + "T23:59:59").toISOString();
    }

    const res = await apiGet({
      action: "getVisitsByDate",
      from: fromDate,
      to: toDate
    });

    setLoading(btn, false);

    const list = $("visitsList");
    list.innerHTML = "";

    const visits = (res.visits || []).filter(v => v.branch === currentBranch);

    if (!visits.length) {
      list.innerHTML = "<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø²ÙŠØ§Ø±Ø§Øª</p>";
      return;
    }

    visits.forEach(v => {
      const div = document.createElement("div");
      div.className = "card";
      div.innerHTML = `
        Ø±Ù‚Ù… Ø§Ù„Ø¹Ø¶ÙˆÙŠØ©: ${v.membership}<br>
        Ù†ÙˆØ¹ Ø§Ù„Ø®Ø¯Ù…Ø©: ${v.service}<br>
        Ø§Ù„Ù…Ø¨Ù„Øº: ${v.price}<br>
        Ø§Ù„Ø¹Ù…ÙˆÙ„Ø©: ${v.commission}<br>
        Ø§Ù„Ù†Ù‚Ø§Ø·: ${v.points}<br>
        Ø§Ù„Ù…ÙˆØ¸Ù: ${v.employee || "â€”"}<br>
        Ø§Ù„ÙØ±Ø¹: ${v.branch || "â€”"}<br>
        Ø§Ù„ØªØ§Ø±ÙŠØ®: ${v.date}
      `;
      list.appendChild(div);
    });
  }

  // CARS
  async function handleLoadCars() {
    const btn = $("carsBtn");
    const phone = $("carsPhone").value.trim();
    if (!phone) return alert("Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„");

    setLoading(btn, true);
    const res = await apiGet({ action: "getCarsByPhone", phone });
    setLoading(btn, false);

    const list = $("carsList");
    list.innerHTML = "";

    if (!res.cars || !res.cars.length) {
      list.innerHTML = "<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³ÙŠØ§Ø±Ø§Øª</p>";
      return;
    }

    res.cars.forEach(c => {
      const div = document.createElement("div");
      div.className = "card";
      div.innerHTML = `
        Ø§Ù„Ø³ÙŠØ§Ø±Ø©: ${c.car} â€” ${c.plate_letters} ${c.plate_numbers}<br>
        Ø§Ù„Ø­Ø¬Ù…: ${c.size}<br>
        Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©: ${c.city}<br>
        Ø±Ù‚Ù… Ø§Ù„Ø¹Ø¶ÙˆÙŠØ©: ${c.membership}
      `;
      list.appendChild(div);
    });
  }

  // ADD VISIT
  let selectedMembership = null;
  let selectedCar = null;
  let servicesMap = {};

  async function loadServices() {
    const res = await apiGet({ action: "getCommissions" });
    const select = $("vService");
    select.innerHTML = "";
    servicesMap = {};

    res.commissions.forEach(s => {
      servicesMap[s.service] = Number(s.price) || 0;
      const opt = document.createElement("option");
      opt.value = s.service;
      opt.textContent = s.service;
      select.appendChild(opt);
    });

    updateVisitPrice();
  }

  function updateVisitPrice() {
    const s = $("vService").value;
    $("vPrice").value = servicesMap[s] || 0;
    updateVisitPoints();
  }

  function updateVisitPoints() {
    const price = Number($("vPrice").value);
    $("vPoints").value = Math.floor(price / 5);
  }

  async function handleVisitSearch() {
    const btn = $("visitSearchBtn");
    const query = $("visitSearch").value.trim();
    if (!query) return alert("Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ Ø£Ùˆ Ø§Ù„Ø¹Ø¶ÙˆÙŠØ©");

    setLoading(btn, true);
    const data = await smartSearchCustomer(query);
    setLoading(btn, false);

    const box = $("visitCarsBox");
    const list = $("visitCarsList");
    list.innerHTML = "";

    if (!data || !data.cars.length) {
      alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø³ÙŠØ§Ø±Ø§Øª Ù…Ø±ØªØ¨Ø·Ø© Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù…ÙŠÙ„");
      box.style.display = "none";
      $("visitForm").style.display = "none";
      return;
    }

    box.style.display = "block";

    data.cars.forEach(c => {
      const div = document.createElement("div");
      div.className = "card";
      div.style.cursor = "pointer";
      div.innerHTML = `
        ${c.car} â€” ${c.plate_letters} ${c.plate_numbers}<br>
        Ø±Ù‚Ù… Ø§Ù„Ø¹Ø¶ÙˆÙŠØ©: ${c.membership}<br>
        Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©: ${c.city}
      `;
      div.onclick = () => selectVisitCar(c);
      list.appendChild(div);
    });
  }

  function selectVisitCar(c) {
    selectedMembership = c.membership;
    selectedCar = c;
    $("visitSelectedInfo").textContent =
      `Ø±Ù‚Ù… Ø§Ù„Ø¹Ø¶ÙˆÙŠØ©: ${c.membership} â€” Ø§Ù„Ø³ÙŠØ§Ø±Ø©: ${c.car} â€” Ø§Ù„Ù„ÙˆØ­Ø©: ${c.plate_letters} ${c.plate_numbers}`;
    $("visitForm").style.display = "block";
  }

  async function handleAddVisit() {
    if (!currentBranch) return alert("Ø§Ø®ØªØ± Ø§Ù„ÙØ±Ø¹ Ø£ÙˆÙ„Ø§Ù‹");
    if (!selectedMembership) return alert("Ø§Ø®ØªØ± Ø§Ù„Ø³ÙŠØ§Ø±Ø© Ø£ÙˆÙ„Ø§Ù‹");

    const btn = $("addVisitBtn");
    setLoading(btn, true);

    const service = $("vService").value;
    const price = Number($("vPrice").value);
    const points = Number($("vPoints").value);

    const res = await apiPost({
      action: "addVisit",
      membership: selectedMembership,
      service,
      price,
      points,
      employee: "",
      branch: currentBranch
    });

    setLoading(btn, false);

    if (res.success) {
      $("addVisitStatus").textContent = "âœ” ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø²ÙŠØ§Ø±Ø© Ø¨Ù†Ø¬Ø§Ø­";
      loadDashboard();
    } else {
      $("addVisitStatus").textContent = "âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„ØªØ³Ø¬ÙŠÙ„";
    }
  }

  // BOOKINGS
  async function loadBookings() {
    const date = $("bookingsDate").value.trim();
    const res = await apiGet({ action: "getBookings", date });

    const list = $("bookingsList");
    list.innerHTML = "";

    if (!res.bookings || !res.bookings.length) {
      list.innerHTML = "<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø­Ø¬ÙˆØ²Ø§Øª</p>";
      return;
    }

    res.bookings.forEach(b => {
      const div = document.createElement("div");
      div.className = "card";
      div.innerHTML = `
        Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„: ${b.phone}<br>
        Ø±Ù‚Ù… Ø§Ù„Ø¹Ø¶ÙˆÙŠØ©: ${b.membership}<br>
        Ù†ÙˆØ¹ Ø§Ù„Ø®Ø¯Ù…Ø©: ${b.service}<br>
        Ø§Ù„ØªØ§Ø±ÙŠØ®: ${b.date} ${b.time}<br>
        Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©: <b>${b.status}</b><br><br>
        <button class="btn-sm btn-secondary" onclick="confirmBooking(${b.row})">ØªØ£ÙƒÙŠØ¯</button>
        <button class="btn-sm btn-danger" onclick="cancelBooking(${b.row})">Ø¥Ù„ØºØ§Ø¡</button>
      `;
      list.appendChild(div);
    });
  }

  async function confirmBooking(row) {
    await apiPost({ action: "updateBookingStatus", row, status: "Approved" });
    loadBookings();
  }

  async function cancelBooking(row) {
    await apiPost({ action: "updateBookingStatus", row, status: "Cancelled" });
    loadBookings();
  }

  // REPORTS
  async function loadReports() {
    if (!currentBranch) return alert("Ø§Ø®ØªØ± Ø§Ù„ÙØ±Ø¹ Ø£ÙˆÙ„Ø§Ù‹");

    const btn = $("reportsBtn");
    const from = $("reportsFrom").value.trim();
    const to = $("reportsTo").value.trim();

    if (!from || !to) return alert("Ø§Ø®ØªØ± Ù…Ù† ÙˆØ¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®");

    setLoading(btn, true);

    const fromDate = new Date(from + "T00:00:00").toISOString();
    const toDate = new Date(to + "T23:59:59").toISOString();

    const res = await apiGet({
      action: "getVisitsByDate",
      from: fromDate,
      to: toDate
    });

    setLoading(btn, false);

    const list = $("reportsList");
    list.innerHTML = "";

    const visits = (res.visits || []).filter(v => v.branch === currentBranch);

    if (!visits.length) {
      list.innerHTML = "<p>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª</p>";
      return;
    }

    visits.forEach(v => {
      const div = document.createElement("div");
      div.className = "card";
      div.innerHTML = `
        Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„: â€” (Ù…Ù† Ø´ÙŠØª Customers Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø©)<br>
        Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„: â€” (Ù…Ù† Ø´ÙŠØª Customers Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø©)<br>
        Ø±Ù‚Ù… Ø§Ù„Ø¹Ø¶ÙˆÙŠØ©: ${v.membership}<br>
        Ù†ÙˆØ¹ Ø§Ù„Ø³ÙŠØ§Ø±Ø©: â€” (Ù…Ù† Ø´ÙŠØª Cars Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø©)<br>
        Ù†ÙˆØ¹ Ø§Ù„Ø®Ø¯Ù…Ø©: ${v.service}<br>
        Ø§Ù„Ù…Ø¨Ù„Øº: ${v.price}<br>
        Ø§Ù„Ø¹Ù…ÙˆÙ„Ø©: ${v.commission}<br>
        Ø§Ù„Ù†Ù‚Ø§Ø·: ${v.points}<br>
        Ø§Ù„Ù…ÙˆØ¸Ù: ${v.employee || "â€”"}<br>
        Ø§Ù„ÙØ±Ø¹: ${v.branch || "â€”"}<br>
        Ø§Ù„ØªØ§Ø±ÙŠØ®: ${v.date}
      `;
      list.appendChild(div);
    });
  }

  // EXPORT EXCEL
  function exportToExcel(visits, filename) {
    const data = visits.map(v => ({
      "Ø±Ù‚Ù… Ø§Ù„Ø¹Ø¶ÙˆÙŠØ©": v.membership,
      "Ù†ÙˆØ¹ Ø§Ù„Ø®Ø¯Ù…Ø©": v.service,
      "Ø§Ù„Ù…Ø¨Ù„Øº": v.price,
      "Ø§Ù„Ø¹Ù…ÙˆÙ„Ø©": v.commission,
      "Ø§Ù„Ù†Ù‚Ø§Ø·": v.points,
      "Ø§Ù„Ù…ÙˆØ¸Ù": v.employee,
      "Ø§Ù„ÙØ±Ø¹": v.branch,
      "Ø§Ù„ØªØ§Ø±ÙŠØ®": v.date
    }));

    const ws = XLSX.utils.json_to_sheet(data);
    const wb = XLSX.utils.book_new();
    XLSX.utils.book_append_sheet(wb, ws, "Report");
    XLSX.writeFile(wb, filename);
  }

  async function handleExport() {
    if (!currentBranch) return alert("Ø§Ø®ØªØ± Ø§Ù„ÙØ±Ø¹ Ø£ÙˆÙ„Ø§Ù‹");

    const btn = $("exportBtn");
    const from = $("exportFrom").value.trim();
    const to = $("exportTo").value.trim();

    if (!from || !to) return alert("Ø§Ø®ØªØ± Ù…Ù† ÙˆØ¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®");

    setLoading(btn, true);

    const fromDate = new Date(from + "T00:00:00").toISOString();
    const toDate = new Date(to + "T23:59:59").toISOString();

    const res = await apiGet({
      action: "getVisitsByDate",
      from: fromDate,
      to: toDate
    });

    setLoading(btn, false);

    const visits = (res.visits || []).filter(v => v.branch === currentBranch);

    if (!visits.length) {
      alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„ÙØªØ±Ø©");
      return;
    }

    const filename = `Branch-${currentBranch}-${from}-to-${to}.xlsx`;
    exportToExcel(visits, filename);
  }

  // EVENTS
  function initEvents() {
    $("searchBtn").addEventListener("click", handleCustomerSearch);
    $("visitsBtn").addEventListener("click", handleLoadVisits);
    $("carsBtn").addEventListener("click", handleLoadCars);
    $("visitSearchBtn").addEventListener("click", handleVisitSearch);
    $("vService").addEventListener("change", updateVisitPrice);
    $("vPrice").addEventListener("input", updateVisitPoints);
    $("addVisitBtn").addEventListener("click", handleAddVisit);
    $("bookingsDate").addEventListener("change", loadBookings);
    $("reportsBtn").addEventListener("click", loadReports);
    $("exportBtn").addEventListener("click", handleExport);
  }

  // INIT
  (async function init() {
    await loadBranches();
    await loadServices();
    await loadDashboard();
    await loadBookings();
    initEvents();
  })();
</script>
</body>
</html>
