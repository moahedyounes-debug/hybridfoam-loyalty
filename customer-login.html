<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>تسجيل الدخول</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="api.js"></script>

<style>
body { font-family:sans-serif; background:#f5f5f5; text-align:center; margin:0; padding:0; }
.header { background:#007bff; color:white; padding:20px; font-size:22px; }
input { width:85%; max-width:350px; padding:12px; margin:10px 0; border-radius:10px; border:1px solid #ccc; font-size:16px; }
button { width:85%; max-width:350px; padding:14px; margin-top:15px; background:#007bff; color:white; border:none; border-radius:10px; font-size:18px; cursor:pointer; }
button:disabled { opacity:0.6; }
.link { display:block; margin-top:15px; color:#007bff; text-decoration:none; }
</style>
</head>

<body>

<div class="header">تسجيل الدخول</div>

<input id="phone" placeholder="رقم الجوال">

<button id="loginBtn" onclick="login()">دخول</button>

<a href="customer-register.html" class="link">تسجيل عميل جديد</a>

<script>
function normalizePhone(phone) {
    phone = String(phone).trim();
    if (!phone.startsWith("0")) phone = "0" + phone;
    return phone;
}

async function login() {
    const btn = document.getElementById("loginBtn");
    btn.disabled = true;
    btn.innerText = "جاري الدخول...";

    let phone = normalizePhone(document.getElementById("phone").value);

    const res = await apiPost({
        action: "loginCustomer",
        phone
    });

    if (!res.success) {
        btn.disabled = false;
        btn.innerText = "دخول";
        alert("رقم غير مسجل");
        return;
    }

    localStorage.setItem("customer_phone", phone);
    window.location.href = "customer-dashboard.html";
}
</script>

</body>
</html>
