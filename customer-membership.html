<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø¹Ø¶ÙˆÙŠØ©</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{
    font-family:"Tajawal",sans-serif;
    background:#000;
    color:white;
    padding:20px;
    text-align:center;
}

h2{
    margin-bottom:20px;
    font-size:24px;
    color:#f5f5f5;
}

/* Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© */
.card{
    width:340px;
    margin:auto;
    border-radius:20px;
    overflow:hidden;
    background:#0d0d0d;
    border:2px solid #d4af37;
    box-shadow:0 0 25px rgba(212,175,55,0.4);
    animation:fadeIn .4s ease;
}

@keyframes fadeIn{
    from{opacity:0;transform:translateY(10px);}
    to{opacity:1;transform:translateY(0);}
}

/* Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø¹Ù„ÙˆÙŠ */
.top{
    padding:22px;
    background:#000;
    color:white;
    text-align:center;
    border-bottom:1px solid #d4af37;
}

.logo{
    width:70px;
    height:70px;
    object-fit:contain;
    margin-bottom:8px;
}

.level-text{
    font-size:22px;
    font-weight:bold;
    margin-top:6px;
    color:#d4af37;
}

.membership{
    font-size:16px;
    margin-top:6px;
    color:#f5f5f5;
}

/* QR */
.qr-box{
    margin-top:12px;
}
.qr-box canvas{
    width:110px !important;
    height:110px !important;
}

/* Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø³ÙÙ„ÙŠ */
.bottom{
    padding:18px;
    text-align:right;
    background:#0d0d0d;
}

.row{
    margin-bottom:8px;
    font-size:15px;
    color:#e5e5e5;
}

.row b{
    color:#d4af37;
}

/* Ø²Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø´Ø§Ø´Ø© */
.add-btn{
    margin-top:15px;
    background:#d4af37;
    color:black;
    padding:12px;
    border-radius:12px;
    font-size:15px;
    cursor:pointer;
    width:100%;
    text-align:center;
    display:none;
    font-weight:bold;
}

.btn-back{
    margin-top:20px;
    padding:12px;
    background:#111;
    border:1px solid #d4af37;
    color:#d4af37;
    border-radius:12px;
    width:100%;
    max-width:340px;
    cursor:pointer;
}
</style>

<script src="api.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrious/4.0.2/qrious.min.js"></script>

</head>

<body>

<h2>Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø¹Ø¶ÙˆÙŠØ©</h2>

<div id="cardContainer"></div>

<button class="btn-back" onclick="window.location.href='customer-dashboard.html'">
Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ÙˆØ­Ø© Ø§Ù„Ø¹Ù…ÙŠÙ„
</button>

<script>
let deferredPrompt;

// Ø¥Ø¸Ù‡Ø§Ø± Ø²Ø± Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø´Ø§Ø´Ø©
window.addEventListener("beforeinstallprompt", (e)=>{
    e.preventDefault();
    deferredPrompt = e;
    const btn = document.getElementById("addBtn");
    if(btn) btn.style.display = "block";
});

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©
async function loadCard(){
    const CUSTOMER = JSON.parse(localStorage.getItem("customer") || "null");

    if(!CUSTOMER){
        alert("ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹");
        location.href = "customer-login.html";
        return;
    }

    // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù„ÙˆÙ† Ø­Ø³Ø¨ Ø§Ù„Ù…Ø³ØªÙˆÙ‰
    let color = "#d4af37"; // Gold default
    let levelText = CUSTOMER.level || "Loyalty";

    if(levelText.includes("VIP")){
        levelText = "ğŸ‘‘ VIP";
        color = "#000"; // VIP Ø£Ø³ÙˆØ¯ Ù…Ù„ÙƒÙŠ
    }

    // Ø¨Ù†Ø§Ø¡ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©
    document.getElementById("cardContainer").innerHTML = `
    <div class="card">
        <div class="top">
            <img src="logo.png" class="logo">
            <div class="level-text">${levelText}</div>
            <div class="membership"><b>Ø±Ù‚Ù… Ø§Ù„Ø¹Ø¶ÙˆÙŠØ©:</b> ${CUSTOMER.membership}</div>

            <div class="qr-box">
                <canvas id="qr"></canvas>
            </div>
        </div>

        <div class="bottom">
            <div class="row"><b>Ø§Ù„Ø§Ø³Ù…:</b> ${CUSTOMER.name}</div>
            <div class="row"><b>Ø§Ù„Ù†Ù‚Ø§Ø·:</b> ${CUSTOMER.points} Ù†Ù‚Ø·Ø©</div>
            <div class="row"><b>Ø¢Ø®Ø± Ø²ÙŠØ§Ø±Ø©:</b> ${CUSTOMER.last_visit || "â€”"}</div>

            <div id="addBtn" class="add-btn" onclick="addToHome()">
                ğŸ“± Ø£Ø¶Ù Ù„Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
            </div>
        </div>
    </div>
    `;

    // QR
    new QRious({
        element: document.getElementById("qr"),
        value: CUSTOMER.phone,
        size: 110
    });
}

function addToHome(){
    if(deferredPrompt){
        deferredPrompt.prompt();
        deferredPrompt = null;
    } else {
        alert("Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ù„Ù„Ø´Ø§Ø´Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©:\n\nğŸ“± iPhone:\nØ§Ø¶ØºØ· Ù…Ø´Ø§Ø±ÙƒØ© â†’ Add to Home Screen\n\nğŸ¤– Android:\nÙ…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© â†’ Add to Home Screen");
    }
}

loadCard();
</script>

</body>
</html>
