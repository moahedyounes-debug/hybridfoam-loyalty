<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Visit Debugger â€“ Hybrid Foam</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body { font-family: "Tajawal", sans-serif; background:#f0f2f5; padding:20px; }
.box { background:white; padding:15px; border-radius:12px; margin-bottom:20px; }
button { width:100%; padding:12px; margin:5px 0; background:#007bff; color:white; border:none; border-radius:8px; }
textarea { width:100%; height:260px; margin-top:10px; }
</style>
</head>

<body>

<h2>ğŸ§ª Visit Debugger â€“ Hybrid Foam</h2>

<div class="box">
    <h3>ğŸ”— API URL</h3>
    <input id="apiUrl" placeholder="Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...">
</div>

<div class="box">
    <h3>ğŸ”¥ Ø§Ø®ØªØ¨Ø§Ø± Ø¥Ø¶Ø§ÙØ© Ø²ÙŠØ§Ø±Ø© (Ø®Ø¯Ù…Ø© ÙˆØ§Ø­Ø¯Ø©)</h3>
    <button onclick="testAddVisit()">ØªØ´ØºÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</button>
</div>

<div class="box">
    <h3>ğŸ”¥ Ø§Ø®ØªØ¨Ø§Ø± Ø¹Ø¯Ø© Ø®Ø¯Ù…Ø§Øª + ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ø®ØµÙ…</h3>
    <button onclick="testMulti()">ØªØ´ØºÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±</button>
</div>

<textarea id="output" placeholder="Ø§Ù„Ù†ØªÙŠØ¬Ø© ØªØ¸Ù‡Ø± Ù‡Ù†Ø§..."></textarea>

<script src="api.js"></script>
<script>
document.addEventListener("DOMContentLoaded", () => {
    if (typeof API_URL !== "undefined") {
        document.getElementById("apiUrl").value = API_URL;
    }
});

async function api(url, data) {
    const form = new URLSearchParams();
    Object.keys(data).forEach(k => form.append(k, data[k]));
    const res = await fetch(url, { method:"POST", body:form });
    return res.json();
}

/* ===========================
   Ø§Ø®ØªØ¨Ø§Ø± Ø®Ø¯Ù…Ø© ÙˆØ§Ø­Ø¯Ø©
=========================== */
async function testAddVisit() {
    const url = el("apiUrl").value;

    const add = await api(url, {
        action:"addVisit",
        membership:"20260001",
        plate_numbers:"Ù…Ø¹Ø§Ù‡Ø¯",
        plate_letters:"Ø£ Ø¨ Ø¬",
        car_type:"Ø³ÙŠØ¯Ø§Ù†",
        car_model:"ÙƒØ§Ù…Ø±ÙŠ",
        car_size:"ÙˆØ³Ø·",
        employee_in:"Ø£Ø­Ù…Ø¯",
        branch:"Ù…ÙƒØ©",
        payment_status:"ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹",
        services: JSON.stringify([
            { name:"Ø®Ø§Ø±Ø¬ÙŠ ØµØºÙŠØ±", price:25, points:3, commission:0 }
        ])
    });

    let out = "ğŸ“Œ Ù†ØªÙŠØ¬Ø© addVisit:\n" + JSON.stringify(add, null, 2);

    if (add.row) {
        out += "\n\nâœ” Ø§Ù„ØµÙ Ø§Ù„Ø°ÙŠ Ù†Ø²Ù„ ÙÙŠ Ø§Ù„Ø´ÙŠØª: " + add.row;
    }

    el("output").value = out;
}

/* ===========================
   Ø§Ø®ØªØ¨Ø§Ø± Ø¹Ø¯Ø© Ø®Ø¯Ù…Ø§Øª
=========================== */
async function testMulti() {
    const url = el("apiUrl").value;

    const services = [
        { name:"ØºØ³ÙŠÙ„", price:25, points:3, commission:0 },
        { name:"ØªÙ„Ù…ÙŠØ¹", price:15, points:3, commission:0 },
        { name:"ØªØºÙ„ÙŠÙ", price:10, points:3, commission:0 }
    ];

    const rows = [];

    for (let s of services) {
        const add = await api(url, {
            action:"addVisit",
            membership:"20260001",
            plate_numbers:"Ù…Ø¹Ø§Ù‡Ø¯",
            plate_letters:"Ø£ Ø¨ Ø¬",
            car_type:"Ø³ÙŠØ¯Ø§Ù†",
            car_model:"ÙƒØ§Ù…Ø±ÙŠ",
            car_size:"ÙˆØ³Ø·",
            employee_in:"Ø£Ø­Ù…Ø¯",
            branch:"Ù…ÙƒØ©",
            payment_status:"ØºÙŠØ± Ù…Ø¯ÙÙˆØ¹",
            services: JSON.stringify([s])
        });

        rows.push(add.row);
    }

    el("output").value =
        "ğŸ“Œ Ø§Ù„ØµÙÙˆÙ Ø§Ù„ØªÙŠ Ù†Ø²Ù„Øª:\n" +
        JSON.stringify(rows, null, 2) +
        "\n\nâš ï¸ Ø§Ù„Ø¢Ù† Ù†Ø¹Ø±Ù Ù‡Ù„ addVisit ÙŠØ±Ø¬Ù‘Ø¹ row Ø£Ù… Ù„Ø§.";
}

function el(id){ return document.getElementById(id); }
</script>

</body>
</html>
