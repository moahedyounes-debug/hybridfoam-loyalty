<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>Ø¨Ø·Ø§Ù‚Ø© Ø±ØºÙˆØ© Ø§Ù„Ù‡Ø¬ÙŠÙ†</title>
  <style>
    body { 
      font-family: 'Segoe UI', Tahoma, sans-serif; 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
      padding: 20px; 
      margin: 0; 
      min-height: 100vh;
      direction: rtl;
    }
    .card { 
      max-width: 400px; 
      margin: auto; 
      background: white; 
      border-radius: 25px; 
      padding: 40px 30px; 
      box-shadow: 0 20px 50px rgba(0,0,0,0.3); 
      text-align: center;
    }
    .bronze { border: 6px solid #CD7F32; }
    .silver { border: 6px solid #C0C0C0; }
    .gold { border: 6px solid #FFD700; }
    .logo { font-size: 28px; color: #4CAF50; margin-bottom: 20px; }
    .points { font-size: 50px; color: #4CAF50; font-weight: bold; margin: 20px 0; }
    .tier { font-size: 24px; padding: 10px; border-radius: 20px; margin: 15px 0; }
    button { 
      padding: 18px 40px; 
      background: linear-gradient(45deg, #FF9800, #F57C00); 
      color: white; 
      border: none; 
      border-radius: 50px; 
      font-size: 20px; 
      cursor: pointer; 
      margin: 15px 5px;
      box-shadow: 0 5px 15px rgba(255,152,0,0.4);
    }
    button:hover { transform: translateY(-2px); }
    button:active { transform: translateY(0); }
    #loading { color: #666; font-style: italic; }
    .id { background: #f0f0f0; padding: 10px; border-radius: 10px; font-family: monospace; }
  </style>
</head>
<body>
  <div id="card" class="card">
    <div id="loading">Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨Ø·Ø§Ù‚ØªÙƒ...</div>
  </div>
  <button onclick="checkIn()" style="display:none;" id="checkinBtn">ğŸš— ØºØ³Ù„ Ø§Ù„ÙŠÙˆÙ… (+10 Ù†Ù‚Ø§Ø·)</button>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const id = urlParams.get('id');
    
    if (!id) {
      document.getElementById('card').innerHTML = '<h2>âŒ ID ØºÙŠØ± ØµØ­ÙŠØ­</h2><p>Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø±Ø§Ø¨Ø· Ø§Ù„ØµØ­ÙŠØ­</p>';
      throw new Error('No ID');
    }
    
    const WEBAPP_URL = 'const WEBAPP_URL = 'https://script.google.com/macros/s/AKfycbyX1xuExmWVy9aVLUJ_Htf5hK9RhG4j5m1T4aA9jemC_C_Ebcw_ujPv7ftg4GjV3B4_/exec';
';  // Ø±Ø§Ø¨Ø·Ùƒ Ø§Ù„Ø£Ø®ÙŠØ±
    
    async function loadCard() {
      try {
        const response = await fetch(`${WEBAPP_URL}?id=${id}`);
        const data = await response.json();
        
        const tierClass = data.tier.toLowerCase();
        document.getElementById('card').innerHTML = `
          <div class="logo">ğŸš— Ø±ØºÙˆØ© Ø§Ù„Ù‡Ø¬ÙŠÙ†</div>
          <div class="id">ID: ${id}</div>
          <h2>${data.name}</h2>
          <div class="points">${data.points} <span style="font-size:30px;">Ù†Ù‚Ø§Ø·</span></div>
          <div class="tier ${tierClass}">${data.tier}</div>
          <div>ØºØ³Ù„Ø§Øª: ${data.visits}</div>
          <small>Ø§Ù„Ø±ÙŠØ§Ø¶ - Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©</small>
        `;
        document.getElementById('checkinBtn').style.display = 'block';
      } catch (error) {
        document.getElementById('card').innerHTML = `
          <h2>ğŸ” Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„...</h2>
          <p>ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ù€ ID Ø£Ùˆ Ø³Ø¬Ù‘Ù„ ÙÙŠ <a href="register.html">register.html</a></p>
        `;
      }
    }
    
    async function checkIn() {
      try {
        document.getElementById('checkinBtn').innerHTML = 'â³ Ø¬Ø§Ø±ÙŠ...';
        const response = await fetch(WEBAPP_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
          body: `id=${id}`
        });
        await response.json();
        loadCard();  // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        alert('âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØºØ³Ù„Ø©! +10 Ù†Ù‚Ø§Ø·');
      } catch (error) {
        alert('âŒ Ø®Ø·Ø£ - ØªØ£ÙƒØ¯ Ù…Ù† Apps Script');
      }
    }
    
    // ØªØ­Ù…ÙŠÙ„ Ø£ÙˆÙ„ Ù…Ø±Ø©
    loadCard();
    
    // ØªØ­Ø¯ÙŠØ« ÙƒÙ„ 30 Ø«Ø§Ù†ÙŠØ©
    setInterval(loadCard, 30000);
  </script>
</body>
</html>
