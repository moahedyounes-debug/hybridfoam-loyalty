<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>تسجيل عميل جديد</title>

<style>
    body {
        background: #000 url('https://raw.githubusercontent.com/moahedyounes-debug/hybridfoam-loyalty/main/logo.png') center 40px no-repeat;
        background-size: 120px;
        color: #d4af37;
        font-family: "Tajawal", sans-serif;
        text-align: center;
        padding: 180px 25px 25px;
    }

    h1 {
        margin-bottom: 20px;
        font-size: 26px;
    }

    .form-container {
        background: rgba(0,0,0,0.65);
        border: 1px solid rgba(212,175,55,0.35);
        border-radius: 14px;
        padding: 15px;
        max-width: 330px;
        margin: auto;
        backdrop-filter: blur(10px);
    }

    input, select {
        width: 100%;
        padding: 10px;
        margin: 6px 0;
        border-radius: 8px;
        border: 1px solid rgba(212,175,55,0.35);
        background: #000 !important;
        color: #fff !important;
        font-size: 15px;
        transition: 0.25s;
        box-sizing: border-box;
    }

    button {
        width: 100%;
        padding: 12px;
        margin-top: 10px;
        border-radius: 10px;
        border: none;
        background: linear-gradient(45deg, #d4af37, #b8962f);
        color: #000;
        font-size: 17px;
        font-weight: bold;
        cursor: pointer;
    }

    #msg {
        margin-top: 10px;
        min-height: 20px;
        font-size: 14px;
    }
</style>
</head>
<body>

<h1>تسجيل عميل جديد</h1>

<div class="form-container">
    <form id="regForm">

        <input type="text" id="name" placeholder="الاسم" required>

        <input type="tel" id="phone" placeholder="رقم الجوال (05XXXXXXXX)" required>

        <input list="carList" id="car" placeholder="نوع السيارة" required>
        <datalist id="carList"></datalist>

        <select id="size" required>
            <option value="">فئة السيارة</option>
            <option value="سيدان">سيدان</option>
            <option value="هاتشباك">هاتشباك</option>
            <option value="SUV">SUV</option>
            <option value="كوبيه">كوبيه</option>
            <option value="بيك أب">بيك أب</option>
            <option value="فان">فان</option>
        </select>

        <input type="text" id="plate_numbers" placeholder="أرقام اللوحة" required>
        <input type="text" id="plate_letters" placeholder="حروف اللوحة" required>

        <button type="submit">تسجيل</button>
    </form>

    <div id="msg"></div>
</div>

<script>
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbymDAk00QPgz7H0QPwpQ9Jgi5tGfNwf7Lf5KD6Mt_bS6b-uC91Yvu1PAd2S8-W-S4fJ0w/exec";

// قائمة السيارات
const cars = [
"تويوتا كامري","تويوتا كورولا","تويوتا يارس","تويوتا أفالون","تويوتا هايلكس",
"تويوتا لاندكروزر","تويوتا برادو","تويوتا فورتشنر","هيونداي سوناتا","هيونداي النترا",
"هيونداي أكسنت","هيونداي توسان","هيونداي سنتافي","كيا سيراتو","كيا أوبتيما",
"كيا سبورتاج","كيا سيلتوس","نيسان ألتيما","نيسان صني","نيسان باترول",
"نيسان إكس تريل","شفروليه تاهو","شفروليه سوبربان","شفروليه ماليبو","شفروليه كابتيفا",
"فورد تورس","فورد إكسبلورر","فورد إسكبيدشن","فورد موستانج","جي إم سي يوكن",
"جي إم سي أكاديا","مرسيدس C-Class","مرسيدس E-Class","مرسيدس S-Class","مرسيدس G-Class",
"بي إم دبليو الفئة الثالثة","بي إم دبليو الفئة الخامسة","بي إم دبليو X5","بي إم دبليو X6",
"لكزس ES","لكزس LS","لكزس RX","لكزس LX"
];

// تعبئة datalist
function fillCarList(filter = "") {
    const list = document.getElementById("carList");
    list.innerHTML = "";
    cars
        .filter(c => c.includes(filter))
        .forEach(c => {
            const opt = document.createElement("option");
            opt.value = c;
            list.appendChild(opt);
        });
}

// تقليص الخيارات حسب الكتابة
document.getElementById("car").addEventListener("input", e => {
    fillCarList(e.target.value.trim());
});

fillCarList(); // أول تعبئة

document.getElementById("regForm").addEventListener("submit", function(e){
    e.preventDefault();

    const msg = document.getElementById("msg");
    msg.style.color = "#d4af37";
    msg.textContent = "⏳ جاري التسجيل...";

    let phone = document.getElementById("phone").value.trim();

    // إصلاح مشكلة حذف الصفر
    if (phone.length === 9 && phone.startsWith("5")) phone = "0" + phone;

    if (!phone.startsWith("05") || phone.length !== 10) {
        msg.style.color = "red";
        msg.textContent = "❌ رقم الجوال غير صحيح";
        return;
    }

    const formData = new FormData();
    formData.append("action", "register");
    formData.append("name", document.getElementById("name").value);
    formData.append("phone", phone);
    formData.append("car", document.getElementById("car").value);
    formData.append("size", document.getElementById("size").value);
    formData.append("plate_numbers", document.getElementById("plate_numbers").value);
    formData.append("plate_letters", document.getElementById("plate_letters").value);

    fetch(SCRIPT_URL, { method: "POST", body: formData })
    .then(res => res.json())
    .then(data => {
        if (data.success) {
            sessionStorage.setItem("login_phone", phone);
            msg.style.color = "#4cff4c";
            msg.textContent = "✔ تم التسجيل بنجاح";
            setTimeout(() => window.location.href = "verify.html", 700);
        }
        else if (data.error === "plate_exists") {
            msg.style.color = "red";
            msg.textContent = "❌ هذه اللوحة مسجلة مسبقًا";
        }
        else {
            msg.style.color = "red";
            msg.textContent = "❌ خطأ غير متوقع";
        }
    });
});
</script>

</body>
</html>
