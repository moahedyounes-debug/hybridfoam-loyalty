<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>تسجيل عميل جديد</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="api.js"></script>

<style>
body { font-family: sans-serif; background:#f5f5f5; margin:0; padding:0; text-align:center; }
.header { background:#007bff; color:white; padding:20px; font-size:22px; }
input { width:85%; max-width:350px; padding:12px; margin:10px 0; border-radius:10px; border:1px solid #ccc; font-size:16px; }
button { width:85%; max-width:350px; padding:14px; margin-top:15px; background:#28a745; color:white; border:none; border-radius:10px; font-size:18px; cursor:pointer; }
button:disabled { opacity:0.6; }
.back { display:block; width:85%; max-width:350px; padding:14px; margin:20px auto; background:#6c757d; color:white; text-decoration:none; border-radius:10px; }
</style>
</head>

<body>

<div class="header">تسجيل عميل جديد</div>

<input id="name" placeholder="الاسم الكامل">
<input id="phone" placeholder="رقم الجوال">

<button id="registerBtn" onclick="registerCustomer()">تسجيل</button>

<a href="customer-login.html" class="back">رجوع</a>

<script>
function normalizePhone(phone) {
    phone = String(phone).trim();
    if (!phone.startsWith("0")) phone = "0" + phone;
    return phone;
}

async function registerCustomer() {
    const btn = document.getElementById("registerBtn");
    btn.disabled = true;
    btn.innerText = "جاري التسجيل...";

    let name = document.getElementById("name").value.trim();
    let phone = normalizePhone(document.getElementById("phone").value);

    const res = await apiPost({
        action: "registerCustomer",
        name,
        phone
    });

    if (!res.success) {
        btn.disabled = false;
        btn.innerText = "تسجيل";
        alert("لم يتم التسجيل");
        return;
    }

    localStorage.setItem("customer_phone", phone);
    window.location.href = "customer-dashboard.html";
}
</script>

</body>
</html>
